<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - CameraControls</title>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
		/>
		<link type="text/css" rel="stylesheet" href="main.css" />
		<style>
			body {
				background-color: #ccc;
				color: rgb(255, 255, 255);
			}

			a {
				color: #f00;
			}
		</style>
	</head>

	<body>
		<div id="info">
			<a href="https://threejs.org" target="_blank" rel="noopener">three.js</a>
			- CameraControls
		</div>

		<script type="module">
			import * as THREE from "../build/three.module.js";

			import { GUI } from "./jsm/libs/dat.gui.module.js";

			import { CameraControls } from "./jsm/controls/CameraControls.js";

			let camera, controls, scene, renderer, gui;

			init();
			//render(); // remove when using next line for animation loop (requestAnimationFrame)
			animate();

			function init() {
				scene = new THREE.Scene();
				scene.background = new THREE.Color(0x333333);

				renderer = new THREE.WebGLRenderer({ antialias: true });
				renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setSize(window.innerWidth, window.innerHeight);
				document.body.appendChild(renderer.domElement);

				camera = new THREE.PerspectiveCamera(
					60,
					window.innerWidth / window.innerHeight,
					0.1,
					3000
				);
				camera.position.set(0, 200, 1000);

				// controls

				controls = new CameraControls(camera, renderer.domElement);
				controls.enableDamping = true;
				controls.maxDistance = 1500;

				// world

				const geometry = new THREE.CylinderGeometry(0.5, 0.5, 1, 32);
				geometry.translate(0, 0.5, 0);
				const material = new THREE.MeshPhongMaterial({
					color: 0xffffff,
					flatShading: true,
				});

				for (let i = 0; i < 500; i++) {
					const mesh = new THREE.Mesh(geometry, material);
					mesh.position.x = Math.random() * 1600 - 800;
					mesh.position.y = 0;
					mesh.position.z = Math.random() * 1600 - 800;
					mesh.scale.x = 20;
					mesh.scale.y = Math.random() * 80 + 10;
					mesh.scale.z = 20;
					mesh.updateMatrix();
					mesh.matrixAutoUpdate = false;
					scene.add(mesh);
				}

				var helper = new THREE.GridHelper(2000, 100);
				helper.material.opacity = 0.25;
				helper.material.transparent = true;
				scene.add(helper);

				// lights

				const dirLight1 = new THREE.DirectionalLight(0xffffff);
				dirLight1.position.set(1, 1, 1);
				scene.add(dirLight1);

				const dirLight2 = new THREE.DirectionalLight(0xffffff * Math.random());
				dirLight2.position.set(-1, -1, -1);
				scene.add(dirLight2);

				const ambientLight = new THREE.AmbientLight(0x222222);
				scene.add(ambientLight);

				//

				window.addEventListener("resize", onWindowResize);

				gui = new GUI();
				gui.add(controls, "dynamicSensibility");
				gui.add(controls, "sensibility", 1, 1500);
			}

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize(window.innerWidth, window.innerHeight);
			}

			function animate() {
				requestAnimationFrame(animate);

				controls.update(); // only required if controls.enableDamping = true, or if controls.autoRotate = true

				gui.updateDisplay();

				render();
			}

			function render() {
				renderer.render(scene, camera);
			}
		</script>
	</body>
</html>
