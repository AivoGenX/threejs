<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - materials - cube reflection [cars]</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #000;
				color: #fff;
				margin: 0px;
				overflow: hidden;
			}
			#info {
				color: #000;
				position: absolute;
				top: 10px;
				width: 100%;
				text-align: center;
				z-index: 100;
				display:block;
			}
			#info a {
				color: red;
				font-weight: bold;
			}
			span {
				white-space: nowrap;
			}
		</style>
	</head>

	<body>
		<div id="info">
			<a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> car materials demo :
			texture by <a href="http://www.humus.name/index.php?page=Textures" target="_blank" rel="noopener">Humus</a> :
			Ferrari F50 model by <a href="http://artist-3d.com/free_3d_models/dnm/model_disp.php?uid=1687" target="_blank" rel="noopener">Daniel Sathya</a>
			<br><br>
			<strong>MATERIALS:</strong>
			<span>Body: <select id="body-mat"></select></span>
			<span>Engine/Wheels: <select id="wheel-mat"></select></span>
			<span>Trim: <select id="trim-mat"></select></span>
			<span>Glass: <select id="glass-mat"></select></span>
		</div>

		<div id="container"></div>

		<script src="../build/three.js"></script>

		<script src="js/loaders/GLTFLoader.js"></script>

		<script src="js/controls/OrbitControls.js"></script>

		<script src="js/Detector.js"></script>
		<script src="js/libs/stats.min.js"></script>

		<script>

			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var camera, scene, renderer, controls, stats;

			var bodyMatSelect = document.getElementById( 'body-mat' );
			var wheelMatSelect = document.getElementById( 'wheel-mat' );
			var trimMatSelect = document.getElementById( 'trim-mat' );
			var glassMatSelect = document.getElementById( 'glass-mat' );

			var car = {
				body: [],
				wheelsTransmission:[],
				glass: [],
				trim: []
			};

			var materialsLib;

			init();
			animate();

			function init() {

				var container = document.getElementById( 'container' );

				camera = new THREE.PerspectiveCamera( 35, window.innerWidth / window.innerHeight, 0.1, 200 );
				camera.position.set( 8, 4, 8 )

				controls = new THREE.OrbitControls( camera, container );
				// controls.autoRotate = true;
				controls.autoRotateSpeed = 0.25;
				controls.enableDamping = true;
				controls.dampingFactor = 0.25;

				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0xa0a0a0 );
				scene.fog = new THREE.Fog( 0xa0a0a0, 10, 60 );

				// ground
				var mesh = new THREE.Mesh( new THREE.PlaneBufferGeometry( 200, 200 ), new THREE.MeshBasicMaterial( { color: 0xffffff } ) );
				mesh.rotation.x = - Math.PI / 2;
				scene.add( mesh );
				var grid = new THREE.GridHelper( 200, 40, 0x000000, 0x000000 );
				grid.material.opacity = 0.25;
				grid.material.transparent = true;
				scene.add( grid );

				var light = new THREE.AmbientLight( 0x999999 );
				scene.add( light );

				light = new THREE.PointLight( 0xffffff );
				camera.add( light );
				scene.add( camera );

				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );

				container.appendChild( renderer.domElement );

				stats = new Stats();
				container.appendChild( stats.dom );

				initMaterials();
				initCar();
				initMaterialSelection();

				window.addEventListener( 'resize', onWindowResize, false );

			}

			function initMaterials() {

				var envMap = new THREE.CubeTextureLoader()
					.setPath( 'textures/cube/Bridge2/')
					.load( [ 'posx.jpg', 'negx.jpg', 'posy.jpg', 'negy.jpg', 'posz.jpg', 'negz.jpg' ] );

				envMapRefraction = envMap.clone();
				envMapRefraction.mapping = THREE.CubeRefractionMapping;
				envMapRefraction.needsUpdate = true;

				materialsLib = {

					main: {

						orangePaint: new THREE.MeshStandardMaterial( { color: 0xff6600, envMap: envMap, metalness: 0.25, roughness: 0.15 } ),
						bluePaint: new THREE.MeshStandardMaterial( { color: 0x001133, envMap: envMap, metalness: 0.25, roughness: 0.15 } ),
						redPaint: new THREE.MeshStandardMaterial( { color: 0x660000, envMap: envMap, metalness: 0.25, roughness: 0.15 } ),
						blackPaint: new THREE.MeshStandardMaterial( { color: 0x000000, envMap: envMap, metalness: 0.25, roughness: 0.15 } ),
						whitePaint: new THREE.MeshStandardMaterial( { color: 0xffffff, envMap: envMap, metalness: 0.25, roughness: 0.15 } ),
						chrome: new THREE.MeshStandardMaterial( { color: 0xcccccc, envMap: envMap, metalness: 0.75, roughness: 0.15 } ),
						gold: new THREE.MeshStandardMaterial( { color: 0xf3d855, envMap: envMap, metalness: 0.75, roughness: 0.15 } ),

					},
					glass: {

						clearGlass: new THREE.MeshStandardMaterial( { color: 0x000000, envMap: envMapRefraction, metalness: 0.0, roughness: 0.25, opacity: 0.5, transparent: true, refractionRatio: 0.25 } ),
						smokedGlass: new THREE.MeshStandardMaterial( { color: 0x000000, envMap: envMapRefraction, metalness: 0, roughness: 0.25, opacity: 0.75, transparent: true, refractionRatio: 0.75 } ),
						blueGlass: new THREE.MeshStandardMaterial( { color: 0x001133, envMap: envMapRefraction, metalness: 0, roughness: 0.25, opacity: 0.5, transparent: true, refractionRatio: 0.75 } ),

					},
				}

			}

			function initCar() {

				var loader = new THREE.GLTFLoader();
				loader.load( 'models/gltf/f50/f50.glb', function( gltf ) {

					var carModel = gltf.scene.children[ 0 ];

					scene.add( carModel );

					car.body.push( carModel.getObjectByName( 'exterior' ) );

					car.wheelsTransmission.push(
						carModel.getObjectByName( 'wheelInnerFrontLeft' ),
						carModel.getObjectByName( 'wheelInnerFrontRight' ),
						carModel.getObjectByName( 'wheelInnerRearLeft' ),
						carModel.getObjectByName( 'wheelInnerRearRight' ),
						carModel.getObjectByName( 'transmission' )
					);

					car.glass.push(
						carModel.getObjectByName( 'windows' ),
						carModel.getObjectByName( 'glass' )
					 );

					car.trim.push( carModel.getObjectByName( 'trim' ) );

					updateMaterials();

				} )
			}

			// set materials to the current values of the selection menus
			function updateMaterials() {

				var bodyMatName = bodyMatSelect.options[ bodyMatSelect.selectedIndex ].value;
				var wheelMatName = wheelMatSelect.options[ wheelMatSelect.selectedIndex ].value;
				var trimMatName = trimMatSelect.options[ trimMatSelect.selectedIndex ].value;
				var glassMatName = glassMatSelect.options[ glassMatSelect.selectedIndex ].value;

				var bodyMat = materialsLib.main[ bodyMatName ];
				var wheelMat = materialsLib.main[ wheelMatName ];
				var trimMat = materialsLib.main[ trimMatName ];
				var glassMat = materialsLib.glass[ glassMatName ];

				car.body.forEach( function ( part ) { part.material = bodyMat; } );
				car.wheelsTransmission.forEach( function ( part ) { part.material = wheelMat; } );
				car.trim.forEach( function ( part ) { part.material = trimMat; } );
				car.glass.forEach( function ( part ) { part.material = glassMat; } );

			}

			// set up material selection menus
			function initMaterialSelection() {

				function changeMat( e ) {

					e.preventDefault();
					updateMaterials();

				};

				function addOption( name, value, menu ) {

					var option = document.createElement( 'option' );
					option.text = name;
					option.value = value;
					menu.add( option );

				}

				Object.keys( materialsLib.main ).forEach( function( materialName ) {

					addOption( materialName, materialName, bodyMatSelect );
					addOption( materialName, materialName, wheelMatSelect );
					addOption( materialName, materialName, trimMatSelect );

				} );

				Object.keys( materialsLib.glass ).forEach( function( materialName ) {

					addOption( materialName, materialName, glassMatSelect );

				} );

				// set initial materials
				bodyMatSelect.selectedIndex = 2;
				wheelMatSelect.selectedIndex = 5;
				trimMatSelect.selectedIndex = 3;
				glassMatSelect.selectedIndex = 0;

				bodyMatSelect.addEventListener( 'change', changeMat );
				wheelMatSelect.addEventListener( 'change', changeMat );
				trimMatSelect.addEventListener( 'change', changeMat );
				glassMatSelect.addEventListener( 'change', changeMat );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function animate() {

				requestAnimationFrame( animate );

				renderer.render( scene, camera );

				controls.update();
				stats.update();

			}

		</script>

	</body>
</html>
