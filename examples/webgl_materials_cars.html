<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - materials - cube reflection [cars]</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #000;
				color: #fff;
				margin: 0px;
				overflow: hidden;
			}
			#info {
				color: #000;
				position: absolute;
				top: 10px;
				width: 100%;
				text-align: center;
				z-index: 100;
				display:block;
			}
			#info a {
				color: red;
				font-weight: bold;
			}
			button {
				border:0;
				background:#000;
				color:#fff;
				padding:0.2em 0.5em;
				cursor:pointer;
				border-radius:3px;
				}
			button:hover { background:#333 }

		</style>
	</head>

	<body>
		<div id="info">
			<a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> car materials demo :
			texture by <a href="http://www.humus.name/index.php?page=Textures" target="_blank" rel="noopener">Humus</a> :
			Ferrari F50 model by <a href="http://artist-3d.com/free_3d_models/dnm/model_disp.php?uid=1687" target="_blank" rel="noopener">Daniel Sathya</a>
			<br>
			<div id="material-selections">
				<strong>MATERIALS:</strong>
				<span>Body:</span>
				<select id="body-mat">
					<option value="orange">Orange</option>
					<option value="blue">Blue</option>
					<option value="red" selected>Red</option>
					<option value="black">Black</option>
					<option value="white">White</option>
				</select>
				<span>Engine/Wheels:</span>
				<select id="wheel-mat">
					<option value="chrome" selected>Chrome</option>
					<option value="white">White</option>
					<option value="gold">Gold</option>
				</select>
				<span>Trim:</span>
				<select id="trim-mat">
					<option value="black" selected>Black</option>
					<option value="white">White</option>
				</select>
				<span>Glass:</span>
				<select id="glass-mat">
					<option value="clear" selected>Clear</option>
					<option value="blue">Blue</option>
					<option value="red">Red</option>
				</select>
			</div>
		</div>

		<div id="container"></div>

		<script src="../build/three.js"></script>

		<script src="js/loaders/GLTFLoader.js"></script>

		<script src="js/controls/OrbitControls.js"></script>

		<script src="js/Detector.js"></script>
		<script src="js/libs/stats.min.js"></script>

		<script>

			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var car = {
				body: [],
				wheelsTransmission:[],
				glass: [],
				trim: []
			};

			var materialsLib;

			var camera, scene, renderer, controls, stats;

			init();
			animate();

			function init() {

				var container = document.getElementById( 'container' );

				camera = new THREE.PerspectiveCamera( 35, window.innerWidth / window.innerHeight, 0.1, 200 );
				camera.position.set( 8, 4, 8 )

				controls = new THREE.OrbitControls( camera, container );
				controls.autoRotate = true;
				controls.autoRotateSpeed = 0.5;
				controls.enableDamping = true;
				controls.dampingFactor = 0.25;

				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0xa0a0a0 );
				scene.fog = new THREE.Fog( 0xa0a0a0, 10, 60 );

				// ground
				var mesh = new THREE.Mesh( new THREE.PlaneBufferGeometry( 200, 200 ), new THREE.MeshBasicMaterial( { color: 0xffffff } ) );
				mesh.rotation.x = - Math.PI / 2;
				scene.add( mesh );
				var grid = new THREE.GridHelper( 200, 40, 0x000000, 0x000000 );
				grid.material.opacity = 0.25;
				grid.material.transparent = true;
				scene.add( grid );

				var light = new THREE.AmbientLight( 0x999999 );
				scene.add( light );

				light = new THREE.PointLight( 0xffffff );
				camera.add( light );
				scene.add( camera );

				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );

				container.appendChild( renderer.domElement );

				stats = new Stats();
				container.appendChild( stats.dom );

				initMaterials();
				initCar();
				initMaterialSelection();

				window.addEventListener( 'resize', onWindowResize, false );

			}

			function initMaterials() {

				var envMap = new THREE.CubeTextureLoader()
					.setPath( 'textures/cube/Bridge2/')
					.load( [ 'posx.jpg', 'negx.jpg', 'posy.jpg', 'negy.jpg', 'posz.jpg', 'negz.jpg' ] );

				var orangeMetal = new THREE.MeshStandardMaterial( { color: 0xff6600, envMap: envMap, metalness: 0.25, roughness: 0.15 } );
				var blueMetal = new THREE.MeshStandardMaterial( { color: 0x001133, envMap: envMap, metalness: 0.25, roughness: 0.15 } );
				var redMetal = new THREE.MeshStandardMaterial( { color: 0x660000, envMap: envMap, metalness: 0.25, roughness: 0.15 } );
				var blackMetal = new THREE.MeshStandardMaterial( { color: 0x000000, envMap: envMap, metalness: 0.25, roughness: 0.15 } );
				var whiteMetal = new THREE.MeshStandardMaterial( { color: 0xffffff, envMap: envMap, metalness: 0.25, roughness: 0.15 } );
				var chrome = new THREE.MeshStandardMaterial( { color: 0xffffff, envMap: envMap, metalness: 0.25, roughness: 0.15 } );
				var goldMetal = new THREE.MeshStandardMaterial( { color: 0xaa9944, envMap: envMap, metalness: 0.25, roughness: 0.15 } );
				var clearGlass = new THREE.MeshStandardMaterial( { color: 0x000000, envMap: envMap, metalness: 0.25, roughness: 0.15, opacity: 0.5, transparent: true } );
				var redGlass = new THREE.MeshStandardMaterial( { color: 0x660000, envMap: envMap, metalness: 0.25, roughness: 0.15, opacity: 0.75, transparent: true } );
				var blueGlass = new THREE.MeshStandardMaterial( { color: 0x001133, envMap: envMap, metalness: 0.25, roughness: 0.15, opacity: 0.75, transparent: true } );

				materialsLib = {
					body: {
						orange: orangeMetal,
						blue: blueMetal,
						red: redMetal,
						black: blackMetal,
						white: whiteMetal,
					},
					wheelsTransmission: {
						chrome: chrome,
						white: whiteMetal,
						gold: goldMetal,
					},
					trim: {
						black: blackMetal,
						white: whiteMetal,
					},
					glass: {
						clear: clearGlass,
						blue: blueGlass,
						red: redGlass,
					}
				}

			}

			function initCar() {

				var loader = new THREE.GLTFLoader();
				loader.load( 'models/gltf/f50/f50.glb', function( gltf ) {

					var carModel = gltf.scene.children[ 0 ];

					scene.add( carModel );

					console.log( carModel )

					car.body.push( carModel.getObjectByName( 'exterior' ) );

					car.wheelsTransmission.push(
						carModel.getObjectByName( 'wheelInnerFrontLeft' ),
						carModel.getObjectByName( 'wheelInnerFrontRight' ),
						carModel.getObjectByName( 'wheelInnerRearLeft' ),
						carModel.getObjectByName( 'wheelInnerRearRight' ),
						carModel.getObjectByName( 'transmission' )
					);

					car.glass.push(
						carModel.getObjectByName( 'windows' ),
						carModel.getObjectByName( 'glass' )
					 );

					car.trim.push( carModel.getObjectByName( 'trim' ) )

				} )
			}

			function initMaterialSelection() {

				function changeMat( e, parts ) {

					e.preventDefault();

					const materialName = e.target.options[e.target.selectedIndex].value;
					const material = materialsLib[ parts ][ materialName ];

					car[ parts ].forEach( function ( part ) { part.material = material; } );

				};

				document.getElementById( 'body-mat' ).addEventListener( 'change', function ( e ) { 	changeMat( e, 'body' ); } );
				document.getElementById( 'wheel-mat' ).addEventListener( 'change', function ( e ) { 	changeMat( e, 'wheelsTransmission' ); } );
				document.getElementById( 'trim-mat' ).addEventListener( 'change', function ( e ) { 	changeMat( e, 'trim' ); } );
				document.getElementById( 'glass-mat' ).addEventListener( 'change', function ( e ) { 	changeMat( e, 'glass' ); } );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function animate() {

				requestAnimationFrame( animate );

				renderer.render( scene, camera );

				controls.update();
				stats.update();

			}

		</script>

	</body>
</html>
