<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webvr - daydream - stereo video</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<!-- Origin Trial Token, feature = WebVR, origin = https://threejs.org, expires = 2017-04-17 -->
		<meta http-equiv="origin-trial" data-feature="WebVR" data-expires="2017-04-17" content="Aj3fKurj0eOvRSbpJ0NaqkV/AE2Y2KJIepdCGWNmCB/iMgbDV/rhFn8zFu6c6zZZlRGZNR7Xv/BEX544EeqLuQAAAABKeyJvcmlnaW4iOiJodHRwczovL3RocmVlanMub3JnOjQ0MyIsImZlYXR1cmUiOiJXZWJWUiIsImV4cGlyeSI6MTQ5MjQ3MzYwMH0=">
		<style>
			body {
				font-family: Monospace;
				background-color: #101010;
				color: #fff;
				margin: 0px;
				overflow: hidden;
			}
			a {
				color: #f00;
			}
		</style>
	</head>
	<body>

		<script src="../build/three.js"></script>

		<script src="js/vr/DaydreamController.js"></script>
		<script src="js/vr/WebVR.js"></script>
		<script src="js/vr/WebVRCamera.js"></script>

		<script>

			if ( WEBVR.isAvailable() === false ) {

				document.body.appendChild( WEBVR.getMessage() );

			}

			//

			var clock = new THREE.Clock();

			var container;
			var camera, scene, ray, raycaster, renderer;
			var gamepad, vrdisplay;

			var room;

			var INTERSECTED;

			init();
			animate();

			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				var info = document.createElement( 'div' );
				info.style.position = 'absolute';
				info.style.top = '10px';
				info.style.width = '100%';
				info.style.textAlign = 'center';
				info.innerHTML = '<a href="https://threejs.org" target="_blank">three.js</a> webvr - daydream - stereo video';
				container.appendChild( info );

				scene = new THREE.Scene();
				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 100 );


				var video = document.createElement( 'video' );
				video.loop = true;
				video.muted = true;
				video.src = 'textures/MaryOculus.webm';
				video.setAttribute( 'webkit-playsinline', 'webkit-playsinline' );
				video.play();

				texture = new THREE.VideoTexture( video );
				texture.minFilter = THREE.NearestFilter;
				texture.maxFilter = THREE.NearestFilter;
				texture.format = THREE.RGBFormat;
				texture.generateMipmaps = false;

				scene = new THREE.Scene();
				

				var material = new THREE.MeshBasicMaterial( { map: texture } );

				// left

				var geometry = new THREE.SphereGeometry( 40, 60, 40 );
				geometry.scale( - 1, 1, 1 );

				var uvs = geometry.faceVertexUvs[ 0 ];

				for ( var i = 0; i < uvs.length; i ++ ) {

					for ( var j = 0; j < 3; j ++ ) {

						uvs[ i ][ j ].x *= 0.5;

					}

				}

				var mesh = new THREE.Mesh( geometry, material );
				mesh.rotation.y = - Math.PI / 2;
				mesh.layers.set( 1 ); // display in left eye only
				scene.add( mesh );

				// right

				var geometry = new THREE.SphereGeometry( 40, 60, 40 );
				geometry.scale( - 1, 1, 1 );

				var uvs = geometry.faceVertexUvs[ 0 ];

				for ( var i = 0; i < uvs.length; i ++ ) {

					for ( var j = 0; j < 3; j ++ ) {

						uvs[ i ][ j ].x *= 0.5;
						uvs[ i ][ j ].x += 0.5;

					}

				}

				var mesh = new THREE.Mesh( geometry, material );
				mesh.rotation.y = - Math.PI / 2;
				mesh.layers.set( 2 ); // display in right eye only
				scene.add( mesh );

		
				//

				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.setClearColor( 0xff0000 );
				container.appendChild( renderer.domElement );

				//

				WEBVR.getVRDisplay( function ( display ) {

					vrdisplay = display;

					camera = new THREE.WebVRCamera( display, renderer );

					document.body.appendChild( WEBVR.getButton( display, renderer.domElement ) );

				} );

				//

				gamepad = new THREE.DaydreamController();
				gamepad.position.set( 0.25, - 0.5, 0 );
				scene.add( gamepad );

				//

				var gamepadHelper = new THREE.Line( new THREE.BufferGeometry(), new THREE.LineBasicMaterial( { linewidth: 4 } ) );
				gamepadHelper.geometry.addAttribute( 'position', new THREE.Float32BufferAttribute( [ 0, 0, 0, 0, 0, - 10 ], 3 ) );
				gamepad.add( gamepadHelper );

				renderer.domElement.addEventListener( 'click', function ( event ) {

					gamepadHelper.material.color.setHex( Math.random() * 0xffffff );

				} );

				//

				window.addEventListener( 'resize', onWindowResize, false );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;

				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			//

			function animate() {

				gamepad.update();
				render();

				( vrdisplay ? vrdisplay : window ).requestAnimationFrame( animate );

			}

			function render() {

				renderer.render( scene, camera );

			}

		</script>
	</body>
</html>
