<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - earth controls</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				color: #000;
				font-family:Monospace;
				font-size:13px;
				text-align:center;
				font-weight: bold;

				background-color: #fff;
				margin: 0px;
				overflow: hidden;
			}

			#info {
				color:#000;
				position: absolute;
				top: 0px; width: 100%;
				padding: 5px;

			}

			a {
				color: red;
			}
		</style>
	</head>

	<body>
		<div id="container"></div>
		<div id="info">
			<a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> - earth controls example
		</div>

		<script src="../build/three.js"></script>

		<script src="js/controls/OrbitControls.js"></script>

		<script src="js/Detector.js"></script>
		<script src="js/libs/stats.min.js"></script>

		<script>

			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var stats;

			var camera, controls, scene, renderer;

			init();
			render(); // remove when using next line for animation loop (requestAnimationFrame)
			//animate();

			function init() {
				var radius = 6400;
				var longitude = 2.333333;
				var latitude = 48.866667;

				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0xcccccc );

				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );

				var container = document.getElementById( 'container' );
				container.appendChild( renderer.domElement );

				camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 100000 );
				camera.up.set(0, 0, 1);
				camera.position.z = 10000;

				controls = new THREE.OrbitControls( camera, renderer.domElement );

				controls.mouseButtons = { ORBIT: THREE.MOUSE.RIGHT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.LEFT };

				controls.panLeft = function() {

					var r = radius;
					return function panLeft( distance, objectMatrix ) {

						var latDelta = - Math.sin( controls.getAzimuthalAngle() ) *
							( distance / 4000 ) * 180 / Math.PI;
						var lonDelta = Math.cos( controls.getAzimuthalAngle() ) *
							( distance / ( r * Math.cos( latitude * Math.PI / 180 ) ) ) * 180 / Math.PI;

						longitude -= lonDelta;

						if ( latitude + latDelta < 80 && latitude + latDelta > - 80 )
							latitude += latDelta;
						longitude = ( longitude + 540 ) % 360 - 180;
						controls.updatePlanet();
	
					};

				}();

				controls.panUp = function() {

					var r = radius;
					return function panUp( distance, objectMatrix ) {

						var lonDelta = Math.sin( controls.getAzimuthalAngle() ) *
							( distance / ( r * Math.cos( latitude * Math.PI / 180 ) ) ) * 180 / Math.PI;
						var latDelta = Math.cos( controls.getAzimuthalAngle() ) *
							( distance / r ) * 180 / Math.PI;
		
						longitude -= lonDelta;

						if (latitude + latDelta < 80 && latitude + latDelta > -80)
							latitude += latDelta;
						longitude = ( longitude + 360 ) % 360;
						controls.updatePlanet();

					};

				}();

				controls.updatePlanet = function() {

					return function update() {

						sphere.rotation.set(
							latitude * Math.PI / 180,
							( 270 - longitude ) * Math.PI / 180,
							0
						);
						render();

					}

				}();

				controls.addEventListener( 'change', render ); // remove when using animation loop
				// enable animation loop when using damping or autorotation
				//controls.enableDamping = true;
				//controls.dampingFactor = 0.25;

				// world

				var geometry = new THREE.SphereGeometry( radius, 24, 24 );
				var material = new THREE.MeshPhongMaterial( {
					color: 0xffffff,
					shininess: 200
				} );
				textureLoader = new THREE.TextureLoader();
				textureLoader.load(
					'textures/planets/earth_atmos_4096.jpg',
					function( tex ) {
						material.map = tex;
						material.needsUpdate = true;
						render();
					}
				);

				var earthCenter = new THREE.Object3D();
				earthCenter.position.set(0, 0, -radius);
				scene.add( earthCenter );

				var sphere = new THREE.Mesh();
				sphere.geometry = geometry;
				sphere.material = material;
				earthCenter.add( sphere );
				controls.updatePlanet();

				// lights

				var light = new THREE.DirectionalLight( 0xffffff );
				light.position.set( 1, 1, 1 );
				scene.add( light );

				var light = new THREE.DirectionalLight( 0x002288 );
				light.position.set( -1, -1, -1 );
				scene.add( light );

				var light = new THREE.AmbientLight( 0x222222 );
				scene.add( light );

				//

				stats = new Stats();
				container.appendChild( stats.dom );

				//

				window.addEventListener( 'resize', onWindowResize, false );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function animate() {

				requestAnimationFrame( animate );

				controls.update(); // required if controls.enableDamping = true, or if controls.autoRotate = true

				stats.update();

				render();

			}

			function render() {

				renderer.render( scene, camera );

			}

		</script>

	</body>
</html>
