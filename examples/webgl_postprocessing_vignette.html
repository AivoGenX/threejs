<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - postprocessing - vignette</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				color: #fff;
				font-family:Monospace;
				font-size:13px;
				text-align:center;
				background-color: #fff;
				margin: 0px;
				overflow: hidden;
			}
			#info {
				position: absolute;
				top: 0px;
				width: 100%;
				padding: 5px;
			}
			#info p {
				max-width: 600px;
				margin-left: auto;
				margin-right: auto;
				padding: 0 2em;
			}
			a {
				color: #2983ff;
			}
		</style>
	</head>

	<body>

		<div id="container"></div>

		<!-- <div id="info">
			<a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> - Bloom pass by <a href="http://eduperiment.com" target="_blank" rel="noopener">Prashant Sharma</a> and <a href="https://clara.io" target="_blank" rel="noopener">Ben Houston</a>
			<p>
				This Bloom Pass is inspired by the bloom pass of the Unreal Engine. It creates a mip map chain of bloom textures and blur them
				with different radii. Because of the weigted combination of mips, and since larger blurs are done on higher mips, this bloom
				is better in quality and performance.
			</p>
			Model: <a href="https://sketchfab.com/models/d3f50a66fee74c6588dd9bc92f7fe7b3" target="_blank" rel="noopener">Primary Ion Drive</a> by
			<a href="https://sketchfab.com/indierocktopus" target="_blank" rel="noopener">indierocktopus</a>, CC Attribution.<br/>
			Details in <a href="https://blog.sketchfab.com/art-spotlight-primary-ion-drive/" target="_blank" rel="noopener">Art Spotlight</a> blog post.
		</div> -->

		<script src="../build/three.js"></script>

		<script src="js/Detector.js"></script>
		<script src="js/libs/dat.gui.min.js"></script>
		<script src="js/controls/OrbitControls.js"></script>
		<script src="js/loaders/GLTFLoader.js"></script>

		<script src="js/postprocessing/EffectComposer.js"></script>
		<script src="js/postprocessing/RenderPass.js"></script>
		<script src="js/postprocessing/ShaderPass.js"></script>

		<script src="js/shaders/CopyShader.js"></script>
		<script src="js/shaders/DigitalGlitch.js"></script>

		<script src="js/postprocessing/VignettePass.js"></script>
		<script src="js/postprocessing/ChromaticPass.js"></script>
		<script src="js/shaders/VignetteShader.js"></script>


		<script>

			var camera, scene, renderer, composer, controls;

			init();
			animate();

			function init() {

				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.body.appendChild( renderer.domElement );

				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.position.z = 2;

				scene = new THREE.Scene();
				scene.fog = new THREE.Fog( 0x000000, 1, 1000 );

				// envmap
				var path = 'textures/cube/skybox/';
				var format = '.jpg';
				var envMap = new THREE.CubeTextureLoader().load( [
					path + 'px' + format, path + 'nx' + format,
					path + 'py' + format, path + 'ny' + format,
					path + 'pz' + format, path + 'nz' + format
				] );
				scene.background = envMap;

				new THREE.GLTFLoader().load( 'models/gltf/DamagedHelmet/glTF/DamagedHelmet.gltf', function ( gltf ) {

					var model = gltf.scene;

					gltf.scene.traverse( function ( child ) {

						if ( child.isMesh ) {

							child.material.envMap = envMap;

						}

					} );

					scene.add( gltf.scene );

					animate();


				} );


				controls = new THREE.OrbitControls( camera, renderer.domElement );
				controls.minDistance = 1;
				controls.maxDistance = 10;
				controls.addEventListener( 'change', animate );




				// postprocessing

				composer = new THREE.EffectComposer( renderer );
				composer.addPass( new THREE.RenderPass( scene, camera ) );
				mypass = new THREE.VignettePass();
				// mypass.renderToScreen = true;
				composer.addPass( mypass );

				chr = new THREE.ChromaticPass();
				chr.renderToScreen = true;
				composer.addPass( chr );


				var params = {
					Vignetting: 0,
					Hardness: 0,
					chromaticAberration: 0
				};

				window.addEventListener( 'resize', onWindowResize, false );


				var gui = new dat.GUI();

				gui.add( params, 'Vignetting', 0, 1 ).step( 0.01 ).onChange( function ( value ) {
					mypass.vignetting = Number( value );
					animate();
				} );
				gui.add( params, 'Hardness', 0, 100 ).step( 0.01 ).onChange( function ( value ) {
					mypass.hardness = Number( value );
					animate();
				} );
				gui.add( params, 'chromaticAberration', 0, 100 ).step( 0.01 ).onChange( function ( value ) {
					chr.chromaticAberration = Number( value );
					animate();
				} );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );
				composer.setSize( window.innerWidth, window.innerHeight );

			}

			function animate() {

				// requestAnimationFrame( animate );

				// scene.rotation.x += 0.005;
				// model.rotation.y += 0.01;

				composer.render();

			}

		</script>

	</body>

</html>
