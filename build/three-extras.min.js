// three.js / threejs.org/license
'use strict';THREE.GeometryUtils={merge:function(b,a,c){console.warn("DEPRECATED: GeometryUtils's .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var d;a instanceof THREE.Mesh&&(a.matrixAutoUpdate&&a.updateMatrix(),d=a.matrix,a=a.geometry);b.merge(a,d,c)},randomPointInTriangle:function(){var b=new THREE.Vector3;return function(a,c,d){var e=new THREE.Vector3,f=THREE.Math.random16(),g=THREE.Math.random16();1<f+g&&(f=1-f,g=1-g);var h=1-f-g;
e.copy(a);e.multiplyScalar(f);b.copy(c);b.multiplyScalar(g);e.add(b);b.copy(d);b.multiplyScalar(h);e.add(b);return e}}(),randomPointInFace:function(b,a,c){return THREE.GeometryUtils.randomPointInTriangle(a.vertices[b.a],a.vertices[b.b],a.vertices[b.c])},randomPointsInGeometry:function(b,a){function c(a){function b(c,d){if(d<c)return c;var e=c+Math.floor((d-c)/2);return l[e]>a?b(c,e-1):l[e]<a?b(e+1,d):e}return b(0,l.length-1)}var d,e,f=b.faces,g=b.vertices,h=f.length,k=0,l=[],n,p,r;for(e=0;e<h;e++)d=
f[e],n=g[d.a],p=g[d.b],r=g[d.c],d._area=THREE.GeometryUtils.triangleArea(n,p,r),k+=d._area,l[e]=k;d=[];for(e=0;e<a;e++)g=THREE.Math.random16()*k,g=c(g),d[e]=THREE.GeometryUtils.randomPointInFace(f[g],b,!0);return d},triangleArea:function(){var b=new THREE.Vector3,a=new THREE.Vector3;return function(c,d,e){b.subVectors(d,c);a.subVectors(e,c);b.cross(a);return 0.5*b.length()}}(),center:function(b){b.computeBoundingBox();var a=b.boundingBox,c=new THREE.Vector3;c.addVectors(a.min,a.max);c.multiplyScalar(-0.5);
b.applyMatrix((new THREE.Matrix4).makeTranslation(c.x,c.y,c.z));b.computeBoundingBox();return c}};THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(b,a,c,d){var e=new THREE.ImageLoader;e.crossOrigin=this.crossOrigin;var f=new THREE.Texture(void 0,a);a=e.load(b,function(){f.needsUpdate=!0;c&&c(f)},void 0,function(a){d&&d(a)});f.image=a;f.sourceFile=b;return f},loadCompressedTexture:function(b,a,c,d){var e=new THREE.CompressedTexture;e.mapping=a;var f=new XMLHttpRequest;f.onload=function(){var a=THREE.ImageUtils.parseDDS(f.response,!0);e.format=a.format;e.mipmaps=a.mipmaps;e.image.width=
a.width;e.image.height=a.height;e.generateMipmaps=!1;e.needsUpdate=!0;c&&c(e)};f.onerror=d;f.open("GET",b,!0);f.responseType="arraybuffer";f.send(null);return e},loadTextureCube:function(b,a,c,d){var e=[];e.loadCount=0;d=new THREE.ImageLoader;d.crossOrigin=this.crossOrigin;var f=new THREE.Texture;f.image=e;void 0!==a&&(f.mapping=a);f.flipY=!1;a=0;for(var g=b.length;a<g;++a){var h=d.load(b[a],function(){e.loadCount+=1;6===e.loadCount&&(f.needsUpdate=!0,c&&c(f))});e[a]=h}return f},loadCompressedTextureCube:function(b,
a,c,d){var e=[];e.loadCount=0;var f=new THREE.CompressedTexture;f.image=e;void 0!==a&&(f.mapping=a);f.flipY=!1;f.generateMipmaps=!1;a=function(a,b){return function(){var d=THREE.ImageUtils.parseDDS(a.response,!0);b.format=d.format;b.mipmaps=d.mipmaps;b.width=d.width;b.height=d.height;e.loadCount+=1;6===e.loadCount&&(f.format=d.format,f.needsUpdate=!0,c&&c(f))}};if(b instanceof Array)for(var g=0,h=b.length;g<h;++g){var k={};e[g]=k;var l=new XMLHttpRequest;l.onload=a(l,k);l.onerror=d;k=b[g];l.open("GET",
k,!0);l.responseType="arraybuffer";l.send(null)}else l=new XMLHttpRequest,l.onload=function(){var a=THREE.ImageUtils.parseDDS(l.response,!0);if(a.isCubemap){for(var b=a.mipmaps.length/a.mipmapCount,d=0;d<b;d++){e[d]={mipmaps:[]};for(var g=0;g<a.mipmapCount;g++)e[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+g]),e[d].format=a.format,e[d].width=a.width,e[d].height=a.height}f.format=a.format;f.needsUpdate=!0;c&&c(f)}},l.onerror=d,l.open("GET",b,!0),l.responseType="arraybuffer",l.send(null);return f},loadDDSTexture:function(b,
a,c,d){var e=[];e.loadCount=0;var f=new THREE.CompressedTexture;f.image=e;void 0!==a&&(f.mapping=a);f.flipY=!1;f.generateMipmaps=!1;var g=new XMLHttpRequest;g.onload=function(){var a=THREE.ImageUtils.parseDDS(g.response,!0);if(a.isCubemap)for(var b=a.mipmaps.length/a.mipmapCount,d=0;d<b;d++){e[d]={mipmaps:[]};for(var n=0;n<a.mipmapCount;n++)e[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+n]),e[d].format=a.format,e[d].width=a.width,e[d].height=a.height}else f.image.width=a.width,f.image.height=a.height,
f.mipmaps=a.mipmaps;f.format=a.format;f.needsUpdate=!0;c&&c(f)};g.onerror=d;g.open("GET",b,!0);g.responseType="arraybuffer";g.send(null);return f},parseDDS:function(b,a){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function d(a,b,c,d){var e=c*d*4;a=new Uint8Array(a,b,e);for(var e=new Uint8Array(e),f=b=0,g=0;g<d;g++)for(var k=0;k<c;k++){var h=a[f];f++;var l=a[f];f++;var r=a[f];f++;var q=a[f];f++;e[b]=r;b++;e[b]=l;b++;e[b]=h;b++;e[b]=q;b++}return e}
var e={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},f=c("DXT1"),g=c("DXT3"),h=c("DXT5"),k=new Int32Array(b,0,31);if(542327876!==k[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),e;if(!k[20]&4)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),e;var l=k[21],n=!1;switch(l){case f:f=8;e.format=THREE.RGB_S3TC_DXT1_Format;break;case g:f=16;e.format=THREE.RGBA_S3TC_DXT3_Format;break;case h:f=16;e.format=THREE.RGBA_S3TC_DXT5_Format;
break;default:if(32==k[22]&&k[23]&16711680&&k[24]&65280&&k[25]&255&&k[26]&4278190080)n=!0,f=64,e.format=THREE.RGBAFormat;else return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(l&255,l>>8&255,l>>16&255,l>>24&255)),e}e.mipmapCount=1;k[2]&131072&&!1!==a&&(e.mipmapCount=Math.max(1,k[7]));e.isCubemap=k[28]&512?!0:!1;e.width=k[4];e.height=k[3];for(var k=k[1]+4,g=e.width,h=e.height,l=e.isCubemap?6:1,p=0;p<l;p++){for(var r=0;r<e.mipmapCount;r++){if(n)var q=d(b,k,
g,h),s=q.length;else s=Math.max(4,g)/4*Math.max(4,h)/4*f,q=new Uint8Array(b,k,s);e.mipmaps.push({data:q,width:g,height:h});k+=s;g=Math.max(0.5*g,1);h=Math.max(0.5*h,1)}g=e.width;h=e.height}return e},getNormalMap:function(b,a){var c=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]};a|=1;var d=b.width,e=b.height,f=document.createElement("canvas");f.width=d;f.height=e;var g=f.getContext("2d");g.drawImage(b,0,0);for(var h=g.getImageData(0,0,d,e).data,k=g.createImageData(d,
e),l=k.data,n=0;n<d;n++)for(var p=0;p<e;p++){var r=0>p-1?0:p-1,q=p+1>e-1?e-1:p+1,s=0>n-1?0:n-1,m=n+1>d-1?d-1:n+1,u=[],v=[0,0,h[4*(p*d+n)]/255*a];u.push([-1,0,h[4*(p*d+s)]/255*a]);u.push([-1,-1,h[4*(r*d+s)]/255*a]);u.push([0,-1,h[4*(r*d+n)]/255*a]);u.push([1,-1,h[4*(r*d+m)]/255*a]);u.push([1,0,h[4*(p*d+m)]/255*a]);u.push([1,1,h[4*(q*d+m)]/255*a]);u.push([0,1,h[4*(q*d+n)]/255*a]);u.push([-1,1,h[4*(q*d+s)]/255*a]);r=[];s=u.length;for(q=0;q<s;q++){var m=u[q],t=u[(q+1)%s],m=[m[0]-v[0],m[1]-v[1],m[2]-v[2]],
t=[t[0]-v[0],t[1]-v[1],t[2]-v[2]];r.push(c([m[1]*t[2]-m[2]*t[1],m[2]*t[0]-m[0]*t[2],m[0]*t[1]-m[1]*t[0]]))}u=[0,0,0];for(q=0;q<r.length;q++)u[0]+=r[q][0],u[1]+=r[q][1],u[2]+=r[q][2];u[0]/=r.length;u[1]/=r.length;u[2]/=r.length;v=4*(p*d+n);l[v]=(u[0]+1)/2*255|0;l[v+1]=(u[1]+1)/2*255|0;l[v+2]=255*u[2]|0;l[v+3]=255}g.putImageData(k,0,0);return f},generateDataTexture:function(b,a,c){var d=b*a,e=new Uint8Array(3*d),f=Math.floor(255*c.r),g=Math.floor(255*c.g);c=Math.floor(255*c.b);for(var h=0;h<d;h++)e[3*
h]=f,e[3*h+1]=g,e[3*h+2]=c;b=new THREE.DataTexture(e,b,a,THREE.RGBFormat);b.needsUpdate=!0;return b}};THREE.SceneUtils={createMultiMaterialObject:function(b,a){for(var c=new THREE.Object3D,d=0,e=a.length;d<e;d++)c.add(new THREE.Mesh(b,a[d]));return c},detach:function(b,a,c){b.applyMatrix(a.matrixWorld);a.remove(b);c.add(b)},attach:function(b,a,c){var d=new THREE.Matrix4;d.getInverse(c.matrixWorld);b.applyMatrix(d);a.remove(b);c.add(b)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(b){var a=b.familyName.toLowerCase();this.faces[a]=this.faces[a]||{};this.faces[a][b.cssFontWeight]=this.faces[a][b.cssFontWeight]||{};this.faces[a][b.cssFontWeight][b.cssFontStyle]=b;return this.faces[a][b.cssFontWeight][b.cssFontStyle]=b},drawText:function(b){var a=this.getFace(),c=this.size/a.resolution,d=0,e=
String(b).split(""),f=e.length,g=[];for(b=0;b<f;b++){var h=new THREE.Path,h=this.extractGlyphPoints(e[b],a,c,d,h),d=d+h.offset;g.push(h.path)}return{paths:g,offset:d/2}},extractGlyphPoints:function(b,a,c,d,e){var f=[],g,h,k,l,n,p,r,q,s,m,u,v=a.glyphs[b]||a.glyphs["?"];if(v){if(v.o)for(a=v._cachedOutline||(v._cachedOutline=v.o.split(" ")),l=a.length,b=0;b<l;)switch(k=a[b++],k){case "m":k=a[b++]*c+d;n=a[b++]*c;e.moveTo(k,n);break;case "l":k=a[b++]*c+d;n=a[b++]*c;e.lineTo(k,n);break;case "q":k=a[b++]*
c+d;n=a[b++]*c;q=a[b++]*c+d;s=a[b++]*c;e.quadraticCurveTo(q,s,k,n);if(g=f[f.length-1])for(p=g.x,r=g.y,g=1,h=this.divisions;g<=h;g++){var t=g/h;THREE.Shape.Utils.b2(t,p,q,k);THREE.Shape.Utils.b2(t,r,s,n)}break;case "b":if(k=a[b++]*c+d,n=a[b++]*c,q=a[b++]*c+d,s=a[b++]*-c,m=a[b++]*c+d,u=a[b++]*-c,e.bezierCurveTo(k,n,q,s,m,u),g=f[f.length-1])for(p=g.x,r=g.y,g=1,h=this.divisions;g<=h;g++)t=g/h,THREE.Shape.Utils.b3(t,p,q,m,k),THREE.Shape.Utils.b3(t,r,s,u,n)}return{offset:v.ha*c,path:e}}}};
THREE.FontUtils.generateShapes=function(b,a){a=a||{};var c=void 0!==a.curveSegments?a.curveSegments:4,d=void 0!==a.font?a.font:"helvetiker",e=void 0!==a.weight?a.weight:"normal",f=void 0!==a.style?a.style:"normal";THREE.FontUtils.size=void 0!==a.size?a.size:100;THREE.FontUtils.divisions=c;THREE.FontUtils.face=d;THREE.FontUtils.weight=e;THREE.FontUtils.style=f;c=THREE.FontUtils.drawText(b).paths;d=[];e=0;for(f=c.length;e<f;e++)Array.prototype.push.apply(d,c[e].toShapes());return d};
(function(b){var a=function(a){for(var b=a.length,e=0,f=b-1,g=0;g<b;f=g++)e+=a[f].x*a[g].y-a[g].x*a[f].y;return 0.5*e};b.Triangulate=function(b,d){var e=b.length;if(3>e)return null;var f=[],g=[],h=[],k,l,n;if(0<a(b))for(l=0;l<e;l++)g[l]=l;else for(l=0;l<e;l++)g[l]=e-1-l;var p=2*e;for(l=e-1;2<e;){if(0>=p--){console.log("Warning, unable to triangulate polygon!");break}k=l;e<=k&&(k=0);l=k+1;e<=l&&(l=0);n=l+1;e<=n&&(n=0);var r;a:{var q=r=void 0,s=void 0,m=void 0,u=void 0,v=void 0,t=void 0,E=void 0,y=
void 0,q=b[g[k]].x,s=b[g[k]].y,m=b[g[l]].x,u=b[g[l]].y,v=b[g[n]].x,t=b[g[n]].y;if(1E-10>(m-q)*(t-s)-(u-s)*(v-q))r=!1;else{var x=void 0,w=void 0,B=void 0,A=void 0,z=void 0,G=void 0,F=void 0,K=void 0,H=void 0,N=void 0,H=K=F=y=E=void 0,x=v-m,w=t-u,B=q-v,A=s-t,z=m-q,G=u-s;for(r=0;r<e;r++)if(E=b[g[r]].x,y=b[g[r]].y,!(E===q&&y===s||E===m&&y===u||E===v&&y===t)&&(F=E-q,K=y-s,H=E-m,N=y-u,E-=v,y-=t,H=x*N-w*H,F=z*K-G*F,K=B*y-A*E,-1E-10<=H&&-1E-10<=K&&-1E-10<=F)){r=!1;break a}r=!0}}if(r){f.push([b[g[k]],b[g[l]],
b[g[n]]]);h.push([g[k],g[l],g[n]]);k=l;for(n=l+1;n<e;k++,n++)g[k]=g[n];e--;p=2*e}}return d?h:f};b.Triangulate.area=a;return b})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(b){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(b){b=this.getUtoTmapping(b);return this.getPoint(b)};THREE.Curve.prototype.getPoints=function(b){b||(b=5);var a,c=[];for(a=0;a<=b;a++)c.push(this.getPoint(a/b));return c};THREE.Curve.prototype.getSpacedPoints=function(b){b||(b=5);var a,c=[];for(a=0;a<=b;a++)c.push(this.getPointAt(a/b));return c};
THREE.Curve.prototype.getLength=function(){var b=this.getLengths();return b[b.length-1]};THREE.Curve.prototype.getLengths=function(b){b||(b=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==b+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var a=[],c,d=this.getPoint(0),e,f=0;a.push(0);for(e=1;e<=b;e++)c=this.getPoint(e/b),f+=c.distanceTo(d),a.push(f),d=c;return this.cacheArcLengths=a};
THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(b,a){var c=this.getLengths(),d=0,e=c.length,f;f=a?a:b*c[e-1];for(var g=0,h=e-1,k;g<=h;)if(d=Math.floor(g+(h-g)/2),k=c[d]-f,0>k)g=d+1;else if(0<k)h=d-1;else{h=d;break}d=h;if(c[d]==f)return d/(e-1);g=c[d];return c=(d+(f-g)/(c[d+1]-g))/(e-1)};THREE.Curve.prototype.getTangent=function(b){var a=b-1E-4;b+=1E-4;0>a&&(a=0);1<b&&(b=1);a=this.getPoint(a);return this.getPoint(b).clone().sub(a).normalize()};
THREE.Curve.prototype.getTangentAt=function(b){b=this.getUtoTmapping(b);return this.getTangent(b)};
THREE.Curve.Utils={tangentQuadraticBezier:function(b,a,c,d){return 2*(1-b)*(c-a)+2*b*(d-c)},tangentCubicBezier:function(b,a,c,d,e){return-3*a*(1-b)*(1-b)+3*c*(1-b)*(1-b)-6*b*c*(1-b)+6*b*d*(1-b)-3*b*b*d+3*b*b*e},tangentSpline:function(b,a,c,d,e){return 6*b*b-6*b+(3*b*b-4*b+1)+(-6*b*b+6*b)+(3*b*b-2*b)},interpolate:function(b,a,c,d,e){b=0.5*(c-b);d=0.5*(d-a);var f=e*e;return(2*a-2*c+b+d)*e*f+(-3*a+3*c-2*b-d)*f+b*e+a}};
THREE.Curve.create=function(b,a){b.prototype=Object.create(THREE.Curve.prototype);b.prototype.getPoint=a;return b};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=!1};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(b){this.curves.push(b)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var b=this.curves[0].getPoint(0),a=this.curves[this.curves.length-1].getPoint(1);b.equals(a)||this.curves.push(new THREE.LineCurve(a,b))};
THREE.CurvePath.prototype.getPoint=function(b){var a=b*this.getLength(),c=this.getCurveLengths();for(b=0;b<c.length;){if(c[b]>=a)return a=c[b]-a,b=this.curves[b],a=1-a/b.getLength(),b.getPointAt(a);b++}return null};THREE.CurvePath.prototype.getLength=function(){var b=this.getCurveLengths();return b[b.length-1]};
THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var b=[],a=0,c,d=this.curves.length;for(c=0;c<d;c++)a+=this.curves[c].getLength(),b.push(a);return this.cacheLengths=b};
THREE.CurvePath.prototype.getBoundingBox=function(){var b=this.getPoints(),a,c,d,e,f,g;a=c=Number.NEGATIVE_INFINITY;e=f=Number.POSITIVE_INFINITY;var h,k,l,n,p=b[0]instanceof THREE.Vector3;n=p?new THREE.Vector3:new THREE.Vector2;k=0;for(l=b.length;k<l;k++)h=b[k],h.x>a?a=h.x:h.x<e&&(e=h.x),h.y>c?c=h.y:h.y<f&&(f=h.y),p&&(h.z>d?d=h.z:h.z<g&&(g=h.z)),n.add(h);b={minX:e,minY:f,maxX:a,maxY:c};p&&(b.maxZ=d,b.minZ=g);return b};
THREE.CurvePath.prototype.createPointsGeometry=function(b){b=this.getPoints(b,!0);return this.createGeometry(b)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(b){b=this.getSpacedPoints(b,!0);return this.createGeometry(b)};THREE.CurvePath.prototype.createGeometry=function(b){for(var a=new THREE.Geometry,c=0;c<b.length;c++)a.vertices.push(new THREE.Vector3(b[c].x,b[c].y,b[c].z||0));return a};THREE.CurvePath.prototype.addWrapPath=function(b){this.bends.push(b)};
THREE.CurvePath.prototype.getTransformedPoints=function(b,a){var c=this.getPoints(b),d,e;a||(a=this.bends);d=0;for(e=a.length;d<e;d++)c=this.getWrapPoints(c,a[d]);return c};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(b,a){var c=this.getSpacedPoints(b),d,e;a||(a=this.bends);d=0;for(e=a.length;d<e;d++)c=this.getWrapPoints(c,a[d]);return c};
THREE.CurvePath.prototype.getWrapPoints=function(b,a){var c=this.getBoundingBox(),d,e,f,g,h,k;d=0;for(e=b.length;d<e;d++)f=b[d],g=f.x,h=f.y,k=g/c.maxX,k=a.getUtoTmapping(k,g),g=a.getPoint(k),k=a.getTangent(k),k.set(-k.y,k.x).multiplyScalar(h),f.x=g.x+k.x,f.y=g.y+k.y;return b};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);
THREE.Gyroscope.prototype.updateMatrixWorld=function(b){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||b)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),
this.matrixWorldNeedsUpdate=!1,b=!0;for(var a=0,c=this.children.length;a<c;a++)this.children[a].updateMatrixWorld(b)};THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3;THREE.Gyroscope.prototype.translationObject=new THREE.Vector3;THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion;THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion;THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3;THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3;THREE.Path=function(b){THREE.CurvePath.call(this);this.actions=[];b&&this.fromPoints(b)};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(b){this.moveTo(b[0].x,b[0].y);for(var a=1,c=b.length;a<c;a++)this.lineTo(b[a].x,b[a].y)};
THREE.Path.prototype.moveTo=function(b,a){var c=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:c})};THREE.Path.prototype.lineTo=function(b,a){var c=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args,d=new THREE.LineCurve(new THREE.Vector2(d[d.length-2],d[d.length-1]),new THREE.Vector2(b,a));this.curves.push(d);this.actions.push({action:THREE.PathActions.LINE_TO,args:c})};
THREE.Path.prototype.quadraticCurveTo=function(b,a,c,d){var e=Array.prototype.slice.call(arguments),f=this.actions[this.actions.length-1].args,f=new THREE.QuadraticBezierCurve(new THREE.Vector2(f[f.length-2],f[f.length-1]),new THREE.Vector2(b,a),new THREE.Vector2(c,d));this.curves.push(f);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:e})};
THREE.Path.prototype.bezierCurveTo=function(b,a,c,d,e,f){var g=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,h=new THREE.CubicBezierCurve(new THREE.Vector2(h[h.length-2],h[h.length-1]),new THREE.Vector2(b,a),new THREE.Vector2(c,d),new THREE.Vector2(e,f));this.curves.push(h);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:g})};
THREE.Path.prototype.splineThru=function(b){var a=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,c=[new THREE.Vector2(c[c.length-2],c[c.length-1])];Array.prototype.push.apply(c,b);c=new THREE.SplineCurve(c);this.curves.push(c);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:a})};THREE.Path.prototype.arc=function(b,a,c,d,e,f){var g=this.actions[this.actions.length-1].args;this.absarc(b+g[g.length-2],a+g[g.length-1],c,d,e,f)};
THREE.Path.prototype.absarc=function(b,a,c,d,e,f){this.absellipse(b,a,c,c,d,e,f)};THREE.Path.prototype.ellipse=function(b,a,c,d,e,f,g){var h=this.actions[this.actions.length-1].args;this.absellipse(b+h[h.length-2],a+h[h.length-1],c,d,e,f,g)};THREE.Path.prototype.absellipse=function(b,a,c,d,e,f,g){var h=Array.prototype.slice.call(arguments),k=new THREE.EllipseCurve(b,a,c,d,e,f,g);this.curves.push(k);k=k.getPoint(1);h.push(k.x);h.push(k.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:h})};
THREE.Path.prototype.getSpacedPoints=function(b,a){b||(b=40);for(var c=[],d=0;d<b;d++)c.push(this.getPoint(d/b));return c};
THREE.Path.prototype.getPoints=function(b,a){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(b,a);b=b||12;var c=[],d,e,f,g,h,k,l,n,p,r,q,s,m;d=0;for(e=this.actions.length;d<e;d++)switch(f=this.actions[d],g=f.action,f=f.args,g){case THREE.PathActions.MOVE_TO:c.push(new THREE.Vector2(f[0],f[1]));break;case THREE.PathActions.LINE_TO:c.push(new THREE.Vector2(f[0],f[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:h=f[2];k=f[3];p=f[0];r=f[1];0<c.length?(g=c[c.length-1],q=g.x,
s=g.y):(g=this.actions[d-1].args,q=g[g.length-2],s=g[g.length-1]);for(f=1;f<=b;f++)m=f/b,g=THREE.Shape.Utils.b2(m,q,p,h),m=THREE.Shape.Utils.b2(m,s,r,k),c.push(new THREE.Vector2(g,m));break;case THREE.PathActions.BEZIER_CURVE_TO:h=f[4];k=f[5];p=f[0];r=f[1];l=f[2];n=f[3];0<c.length?(g=c[c.length-1],q=g.x,s=g.y):(g=this.actions[d-1].args,q=g[g.length-2],s=g[g.length-1]);for(f=1;f<=b;f++)m=f/b,g=THREE.Shape.Utils.b3(m,q,p,l,h),m=THREE.Shape.Utils.b3(m,s,r,n,k),c.push(new THREE.Vector2(g,m));break;case THREE.PathActions.CSPLINE_THRU:g=
this.actions[d-1].args;m=[new THREE.Vector2(g[g.length-2],g[g.length-1])];g=b*f[0].length;m=m.concat(f[0]);m=new THREE.SplineCurve(m);for(f=1;f<=g;f++)c.push(m.getPointAt(f/g));break;case THREE.PathActions.ARC:h=f[0];k=f[1];r=f[2];l=f[3];g=f[4];p=!!f[5];q=g-l;s=2*b;for(f=1;f<=s;f++)m=f/s,p||(m=1-m),m=l+m*q,g=h+r*Math.cos(m),m=k+r*Math.sin(m),c.push(new THREE.Vector2(g,m));break;case THREE.PathActions.ELLIPSE:for(h=f[0],k=f[1],r=f[2],n=f[3],l=f[4],g=f[5],p=!!f[6],q=g-l,s=2*b,f=1;f<=s;f++)m=f/s,p||
(m=1-m),m=l+m*q,g=h+r*Math.cos(m),m=k+n*Math.sin(m),c.push(new THREE.Vector2(g,m))}d=c[c.length-1];1E-10>Math.abs(d.x-c[0].x)&&1E-10>Math.abs(d.y-c[0].y)&&c.splice(c.length-1,1);a&&c.push(c[0]);return c};
THREE.Path.prototype.toShapes=function(b,a){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new THREE.Shape;f.actions=e.actions;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],k=b[f],h=k.x-g.x,l=k.y-g.y;if(1E-10<Math.abs(l)){if(0>l&&(g=b[f],h=-h,k=b[e],l=-l),!(a.y<g.y||a.y>k.y))if(a.y==g.y){if(a.x==g.x)return!0}else{e=l*(a.x-g.x)-h*(a.y-g.y);if(0==e)return!0;0>e||(d=!d)}}else if(a.y==g.y&&(k.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=
k.x))return!0}return d}var e=function(a){var b,c,d,e,f=[],g=new THREE.Path;b=0;for(c=a.length;b<c;b++)d=a[b],e=d.args,d=d.action,d==THREE.PathActions.MOVE_TO&&0!=g.actions.length&&(f.push(g),g=new THREE.Path),g[d].apply(g,e);0!=g.actions.length&&f.push(g);return f}(this.actions);if(0==e.length)return[];if(!0===a)return c(e);var f,g,h,k=[];if(1==e.length)return g=e[0],h=new THREE.Shape,h.actions=g.actions,h.curves=g.curves,k.push(h),k;var l=!THREE.Shape.Utils.isClockWise(e[0].getPoints()),l=b?!l:l;
h=[];var n=[],p=[],r=0,q;n[r]=void 0;p[r]=[];var s,m;s=0;for(m=e.length;s<m;s++)g=e[s],q=g.getPoints(),f=THREE.Shape.Utils.isClockWise(q),(f=b?!f:f)?(!l&&n[r]&&r++,n[r]={s:new THREE.Shape,p:q},n[r].s.actions=g.actions,n[r].s.curves=g.curves,l&&r++,p[r]=[]):p[r].push({h:g,p:q[0]});if(!n[0])return c(e);if(1<n.length){s=!1;m=[];g=0;for(e=n.length;g<e;g++)h[g]=[];g=0;for(e=n.length;g<e;g++)for(f=p[g],l=0;l<f.length;l++){r=f[l];q=!0;for(var u=0;u<n.length;u++)d(r.p,n[u].p)&&(g!=u&&m.push({froms:g,tos:u,
hole:l}),q?(q=!1,h[u].push(r)):s=!0);q&&h[g].push(r)}0<m.length&&(s||(p=h))}s=0;for(m=n.length;s<m;s++)for(h=n[s].s,k.push(h),g=p[s],e=0,f=g.length;e<f;e++)h.holes.push(g[e].h);return k};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(b){return new THREE.ExtrudeGeometry(this,b)};THREE.Shape.prototype.makeGeometry=function(b){return new THREE.ShapeGeometry(this,b)};THREE.Shape.prototype.getPointsHoles=function(b){var a,c=this.holes.length,d=[];for(a=0;a<c;a++)d[a]=this.holes[a].getTransformedPoints(b,this.bends);return d};
THREE.Shape.prototype.getSpacedPointsHoles=function(b){var a,c=this.holes.length,d=[];for(a=0;a<c;a++)d[a]=this.holes[a].getTransformedSpacedPoints(b,this.bends);return d};THREE.Shape.prototype.extractAllPoints=function(b){return{shape:this.getTransformedPoints(b),holes:this.getPointsHoles(b)}};THREE.Shape.prototype.extractPoints=function(b){return this.useSpacedPoints?this.extractAllSpacedPoints(b):this.extractAllPoints(b)};
THREE.Shape.prototype.extractAllSpacedPoints=function(b){return{shape:this.getTransformedSpacedPoints(b),holes:this.getSpacedPointsHoles(b)}};
THREE.Shape.Utils={triangulateShape:function(b,a){function c(a,b,c){return a.x!=b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function d(a,b,d,e,f){var g=b.x-a.x,k=b.y-a.y,h=e.x-d.x,l=e.y-d.y,n=a.x-d.x,p=a.y-d.y,B=k*h-g*l,A=k*n-g*p;if(1E-10<Math.abs(B)){if(0<B){if(0>A||A>B)return[];h=l*n-h*p;if(0>h||h>B)return[]}else{if(0<A||A<B)return[];h=l*n-h*p;if(0<h||h<B)return[]}if(0==h)return!f||0!=A&&A!=B?[a]:[];if(h==B)return!f||0!=A&&A!=B?[b]:[];if(0==A)return[d];
if(A==B)return[e];f=h/B;return[{x:a.x+f*g,y:a.y+f*k}]}if(0!=A||l*n!=h*p)return[];k=0==g&&0==k;h=0==h&&0==l;if(k&&h)return a.x!=d.x||a.y!=d.y?[]:[a];if(k)return c(d,e,a)?[a]:[];if(h)return c(a,b,d)?[d]:[];0!=g?(a.x<b.x?(g=a,h=a.x,k=b,a=b.x):(g=b,h=b.x,k=a,a=a.x),d.x<e.x?(b=d,B=d.x,l=e,d=e.x):(b=e,B=e.x,l=d,d=d.x)):(a.y<b.y?(g=a,h=a.y,k=b,a=b.y):(g=b,h=b.y,k=a,a=a.y),d.y<e.y?(b=d,B=d.y,l=e,d=e.y):(b=e,B=e.y,l=d,d=d.y));return h<=B?a<B?[]:a==B?f?[]:[b]:a<=d?[b,k]:[b,l]:h>d?[]:h==d?f?[]:[g]:a<=d?[g,k]:
[g,l]}function e(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var g=d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return 1E-10<Math.abs(a)?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}var f,g,h,k,l,n={};h=b.concat();f=0;for(g=a.length;f<g;f++)Array.prototype.push.apply(h,a[f]);f=0;for(g=h.length;f<g;f++)l=h[f].x+":"+h[f].y,void 0!==n[l]&&console.log("Duplicate point",l),n[l]=f;f=function(a,b){function c(a,b){var d=k.length-1,f=a-1;0>f&&(f=d);var g=a+1;g>d&&(g=0);d=e(k[a],k[f],k[g],h[b]);if(!d)return!1;
d=h.length-1;f=b-1;0>f&&(f=d);g=b+1;g>d&&(g=0);return(d=e(h[b],h[f],h[g],k[a]))?!0:!1}function f(a,b){var c,e;for(c=0;c<k.length;c++)if(e=c+1,e%=k.length,e=d(a,b,k[c],k[e],!0),0<e.length)return!0;return!1}function g(a,c){var e,f,k,h;for(e=0;e<l.length;e++)for(f=b[l[e]],k=0;k<f.length;k++)if(h=k+1,h%=f.length,h=d(a,c,f[k],f[h],!0),0<h.length)return!0;return!1}var k=a.concat(),h,l=[],n,p,w,B,A,z=[],G,F,K,H=0;for(n=b.length;H<n;H++)l.push(H);G=0;for(var N=2*l.length;0<l.length;){N--;if(0>N){console.log("Infinite Loop! Holes left:"+
l.length+", Probably Hole outside Shape!");break}for(p=G;p<k.length;p++){w=k[p];n=-1;for(H=0;H<l.length;H++)if(B=l[H],A=w.x+":"+w.y+":"+B,void 0===z[A]){h=b[B];for(F=0;F<h.length;F++)if(B=h[F],c(p,F)&&!f(w,B)&&!g(w,B)){n=F;l.splice(H,1);G=k.slice(0,p+1);B=k.slice(p);F=h.slice(n);K=h.slice(0,n+1);k=G.concat(F).concat(K).concat(B);G=p;break}if(0<=n)break;z[A]=!0}if(0<=n)break}}return k}(b,a);var p=THREE.FontUtils.Triangulate(f,!1);f=0;for(g=p.length;f<g;f++)for(k=p[f],h=0;3>h;h++)l=k[h].x+":"+k[h].y,
l=n[l],void 0!==l&&(k[h]=l);return p.concat()},isClockWise:function(b){return 0>THREE.FontUtils.Triangulate.area(b)},b2p0:function(b,a){var c=1-b;return c*c*a},b2p1:function(b,a){return 2*(1-b)*b*a},b2p2:function(b,a){return b*b*a},b2:function(b,a,c,d){return this.b2p0(b,a)+this.b2p1(b,c)+this.b2p2(b,d)},b3p0:function(b,a){var c=1-b;return c*c*c*a},b3p1:function(b,a){var c=1-b;return 3*c*c*b*a},b3p2:function(b,a){return 3*(1-b)*b*b*a},b3p3:function(b,a){return b*b*b*a},b3:function(b,a,c,d,e){return this.b3p0(b,
a)+this.b3p1(b,c)+this.b3p2(b,d)+this.b3p3(b,e)}};THREE.LineCurve=function(b,a){this.v1=b;this.v2=a};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(b){var a=this.v2.clone().sub(this.v1);a.multiplyScalar(b).add(this.v1);return a};THREE.LineCurve.prototype.getPointAt=function(b){return this.getPoint(b)};THREE.LineCurve.prototype.getTangent=function(b){return this.v2.clone().sub(this.v1).normalize()};THREE.QuadraticBezierCurve=function(b,a,c){this.v0=b;this.v1=a;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.getPoint=function(b){var a;a=THREE.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);b=THREE.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(a,b)};
THREE.QuadraticBezierCurve.prototype.getTangent=function(b){var a;a=THREE.Curve.Utils.tangentQuadraticBezier(b,this.v0.x,this.v1.x,this.v2.x);b=THREE.Curve.Utils.tangentQuadraticBezier(b,this.v0.y,this.v1.y,this.v2.y);a=new THREE.Vector2(a,b);a.normalize();return a};THREE.CubicBezierCurve=function(b,a,c,d){this.v0=b;this.v1=a;this.v2=c;this.v3=d};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.getPoint=function(b){var a;a=THREE.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=THREE.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(a,b)};
THREE.CubicBezierCurve.prototype.getTangent=function(b){var a;a=THREE.Curve.Utils.tangentCubicBezier(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=THREE.Curve.Utils.tangentCubicBezier(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);a=new THREE.Vector2(a,b);a.normalize();return a};THREE.SplineCurve=function(b){this.points=void 0==b?[]:b};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(b){var a=new THREE.Vector2,c=[],d=this.points,e;e=(d.length-1)*b;b=Math.floor(e);e-=b;c[0]=0==b?b:b-1;c[1]=b;c[2]=b>d.length-2?d.length-1:b+1;c[3]=b>d.length-3?d.length-1:b+2;a.x=THREE.Curve.Utils.interpolate(d[c[0]].x,d[c[1]].x,d[c[2]].x,d[c[3]].x,e);a.y=THREE.Curve.Utils.interpolate(d[c[0]].y,d[c[1]].y,d[c[2]].y,d[c[3]].y,e);return a};THREE.EllipseCurve=function(b,a,c,d,e,f,g){this.aX=b;this.aY=a;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);
THREE.EllipseCurve.prototype.getPoint=function(b){var a;a=this.aEndAngle-this.aStartAngle;0>a&&(a+=2*Math.PI);a>2*Math.PI&&(a-=2*Math.PI);a=!0===this.aClockwise?this.aEndAngle+(1-b)*(2*Math.PI-a):this.aStartAngle+b*a;b=this.aX+this.xRadius*Math.cos(a);a=this.aY+this.yRadius*Math.sin(a);return new THREE.Vector2(b,a)};THREE.ArcCurve=function(b,a,c,d,e,f){THREE.EllipseCurve.call(this,b,a,c,c,d,e,f)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.LineCurve3=THREE.Curve.create(function(b,a){this.v1=b;this.v2=a},function(b){var a=new THREE.Vector3;a.subVectors(this.v2,this.v1);a.multiplyScalar(b);a.add(this.v1);return a});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(b,a,c){this.v0=b;this.v1=a;this.v2=c},function(b){var a,c;a=THREE.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);c=THREE.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);b=THREE.Shape.Utils.b2(b,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(a,c,b)});THREE.CubicBezierCurve3=THREE.Curve.create(function(b,a,c,d){this.v0=b;this.v1=a;this.v2=c;this.v3=d},function(b){var a,c;a=THREE.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);c=THREE.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);b=THREE.Shape.Utils.b3(b,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(a,c,b)});THREE.SplineCurve3=THREE.Curve.create(function(b){this.points=void 0==b?[]:b},function(b){var a=new THREE.Vector3,c=[],d=this.points,e;b*=d.length-1;e=Math.floor(b);b-=e;c[0]=0==e?e:e-1;c[1]=e;c[2]=e>d.length-2?d.length-1:e+1;c[3]=e>d.length-3?d.length-1:e+2;e=d[c[0]];var f=d[c[1]],g=d[c[2]],c=d[c[3]];a.x=THREE.Curve.Utils.interpolate(e.x,f.x,g.x,c.x,b);a.y=THREE.Curve.Utils.interpolate(e.y,f.y,g.y,c.y,b);a.z=THREE.Curve.Utils.interpolate(e.z,f.z,g.z,c.z,b);return a});THREE.ClosedSplineCurve3=THREE.Curve.create(function(b){this.points=void 0==b?[]:b},function(b){var a=new THREE.Vector3,c=[],d=this.points,e;e=(d.length-0)*b;b=Math.floor(e);e-=b;b+=0<b?0:(Math.floor(Math.abs(b)/d.length)+1)*d.length;c[0]=(b-1)%d.length;c[1]=b%d.length;c[2]=(b+1)%d.length;c[3]=(b+2)%d.length;a.x=THREE.Curve.Utils.interpolate(d[c[0]].x,d[c[1]].x,d[c[2]].x,d[c[3]].x,e);a.y=THREE.Curve.Utils.interpolate(d[c[0]].y,d[c[1]].y,d[c[2]].y,d[c[3]].y,e);a.z=THREE.Curve.Utils.interpolate(d[c[0]].z,
d[c[1]].z,d[c[2]].z,d[c[3]].z,e);return a});THREE.AnimationHandler=function(){var b=[],a={},c={update:function(a){for(var c=0;c<b.length;c++)b[c].update(a)},addToUpdate:function(a){-1===b.indexOf(a)&&b.push(a)},removeFromUpdate:function(a){a=b.indexOf(a);-1!==a&&b.splice(a,1)},add:function(b){void 0!==a[b.name]&&console.log("THREE.AnimationHandler.add: Warning! "+b.name+" already exists in library. Overwriting.");a[b.name]=b;if(!0!==b.initialized){for(var c=0;c<b.hierarchy.length;c++){for(var d=0;d<b.hierarchy[c].keys.length;d++)if(0>b.hierarchy[c].keys[d].time&&
(b.hierarchy[c].keys[d].time=0),void 0!==b.hierarchy[c].keys[d].rot&&!(b.hierarchy[c].keys[d].rot instanceof THREE.Quaternion)){var h=b.hierarchy[c].keys[d].rot;b.hierarchy[c].keys[d].rot=(new THREE.Quaternion).fromArray(h)}if(b.hierarchy[c].keys.length&&void 0!==b.hierarchy[c].keys[0].morphTargets){h={};for(d=0;d<b.hierarchy[c].keys.length;d++)for(var k=0;k<b.hierarchy[c].keys[d].morphTargets.length;k++){var l=b.hierarchy[c].keys[d].morphTargets[k];h[l]=-1}b.hierarchy[c].usedMorphTargets=h;for(d=
0;d<b.hierarchy[c].keys.length;d++){var n={};for(l in h){for(k=0;k<b.hierarchy[c].keys[d].morphTargets.length;k++)if(b.hierarchy[c].keys[d].morphTargets[k]===l){n[l]=b.hierarchy[c].keys[d].morphTargetsInfluences[k];break}k===b.hierarchy[c].keys[d].morphTargets.length&&(n[l]=0)}b.hierarchy[c].keys[d].morphTargetsInfluences=n}}for(d=1;d<b.hierarchy[c].keys.length;d++)b.hierarchy[c].keys[d].time===b.hierarchy[c].keys[d-1].time&&(b.hierarchy[c].keys.splice(d,1),d--);for(d=0;d<b.hierarchy[c].keys.length;d++)b.hierarchy[c].keys[d].index=
d}b.initialized=!0}},remove:function(b){void 0===a[b]&&console.log("THREE.AnimationHandler.add: Warning! "+b+" doesn't exists in library. Doing nothing.");a[b]=void 0},get:function(b){if("string"===typeof b)return a[b]?a[b]:null},parse:function(a){var b=[];if(a instanceof THREE.SkinnedMesh)for(var c=0;c<a.bones.length;c++)b.push(a.bones[c]);else d(a,b);return b}},d=function(a,b){b.push(a);for(var c=0;c<a.children.length;c++)d(a.children[c],b)};c.LINEAR=0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c}();THREE.Animation=function(b,a){this.root=b;this.data=THREE.AnimationHandler.get(a);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.interpolationType=THREE.AnimationHandler.LINEAR};THREE.Animation.prototype.play=function(b){this.currentTime=void 0!==b?b:0;!1===this.isPlaying&&(this.isPlaying=!0,this.reset(),this.update(0));this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};
THREE.Animation.prototype.pause=function(){!0===this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.removeFromUpdate(this)};
THREE.Animation.prototype.reset=function(){for(var b=0,a=this.hierarchy.length;b<a;b++){var c=this.hierarchy[b];c.matrixAutoUpdate=!0;void 0===c.animationCache&&(c.animationCache={},c.animationCache.prevKey={pos:0,rot:0,scl:0},c.animationCache.nextKey={pos:0,rot:0,scl:0},c.animationCache.originalMatrix=c instanceof THREE.Bone?c.skinMatrix:c.matrix);var d=c.animationCache.prevKey,c=c.animationCache.nextKey;void 0!==this.data.hierarchy[b].keys&&0<this.data.hierarchy[b].keys.length&&(d.pos=this.data.hierarchy[b].keys[0],
d.rot=this.data.hierarchy[b].keys[0],d.scl=this.data.hierarchy[b].keys[0]);c.pos=this.getNextKeyWith("pos",b,1);c.rot=this.getNextKeyWith("rot",b,1);c.scl=this.getNextKeyWith("scl",b,1)}};
THREE.Animation.prototype.update=function(){var b=[],a=new THREE.Vector3,c=function(a,b){var c=[],h=[],k,l,n,p,r,q;k=(a.length-1)*b;l=Math.floor(k);k-=l;c[0]=0===l?l:l-1;c[1]=l;c[2]=l>a.length-2?l:l+1;c[3]=l>a.length-3?l:l+2;l=a[c[0]];p=a[c[1]];r=a[c[2]];q=a[c[3]];c=k*k;n=k*c;h[0]=d(l[0],p[0],r[0],q[0],k,c,n);h[1]=d(l[1],p[1],r[1],q[1],k,c,n);h[2]=d(l[2],p[2],r[2],q[2],k,c,n);return h},d=function(a,b,c,d,k,l,n){a=0.5*(c-a);d=0.5*(d-b);return(2*(b-c)+a+d)*n+(-3*(b-c)-2*a-d)*l+a*k+b};return function(d){if(!1!==
this.isPlaying){this.currentTime+=d*this.timeScale;var f;d=["pos","rot","scl"];var g=this.data.length;if(!0===this.loop&&this.currentTime>g)this.currentTime%=g,this.reset();else if(!1===this.loop&&this.currentTime>g){this.stop();return}this.currentTime=Math.min(this.currentTime,g);for(var g=0,h=this.hierarchy.length;g<h;g++)for(var k=this.hierarchy[g],l=k.animationCache,n=0;3>n;n++){f=d[n];var p=l.prevKey[f],r=l.nextKey[f];if(p&&p[f]&&r&&r[f]){if(r.time<=this.currentTime){p=this.data.hierarchy[g].keys[0];
for(r=this.getNextKeyWith(f,g,1);r.time<this.currentTime&&r.index>p.index;)p=r,r=this.getNextKeyWith(f,g,r.index+1);l.prevKey[f]=p;l.nextKey[f]=r}k.matrixAutoUpdate=!0;k.matrixWorldNeedsUpdate=!0;var q=(this.currentTime-p.time)/(r.time-p.time),s=p[f],m=r[f];0>q&&(q=0);1<q&&(q=1);if("pos"===f)if(f=k.position,this.interpolationType===THREE.AnimationHandler.LINEAR)f.x=s[0]+(m[0]-s[0])*q,f.y=s[1]+(m[1]-s[1])*q,f.z=s[2]+(m[2]-s[2])*q;else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||
this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)b[0]=this.getPrevKeyWith("pos",g,p.index-1).pos,b[1]=s,b[2]=m,b[3]=this.getNextKeyWith("pos",g,r.index+1).pos,q=0.33*q+0.33,p=c(b,q),f.x=p[0],f.y=p[1],f.z=p[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(q=c(b,1.01*q),a.set(q[0],q[1],q[2]),a.sub(f),a.y=0,a.normalize(),f=Math.atan2(a.x,a.z),k.rotation.set(0,f,0))}else"rot"===f?THREE.Quaternion.slerp(s,m,k.quaternion,q):"scl"===f&&(f=k.scale,f.x=s[0]+(m[0]-s[0])*
q,f.y=s[1]+(m[1]-s[1])*q,f.z=s[2]+(m[2]-s[2])*q)}}}}}();THREE.Animation.prototype.getNextKeyWith=function(b,a,c){var d=this.data.hierarchy[a].keys;if(void 0!==d&&0<d.length){for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c<d.length-1?c:d.length-1:c%d.length;c<d.length;c++)if(void 0!==d[c][b])return d[c];return this.data.hierarchy[a].keys[0]}return null};
THREE.Animation.prototype.getPrevKeyWith=function(b,a,c){var d=this.data.hierarchy[a].keys;if(void 0!==d&&0<d.length){for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<c?c:0:0<=c?c:c+d.length;0<=c;c--)if(void 0!==d[c][b])return d[c];return this.data.hierarchy[a].keys[d.length-1]}return null};THREE.KeyFrameAnimation=function(b,a){this.root=b;this.data=THREE.AnimationHandler.get(a);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=0.001;this.isPlaying=!1;this.loop=this.isPaused=!0;for(var c=0,d=this.hierarchy.length;c<d;c++){var e=this.data.hierarchy[c].sids,f=this.hierarchy[c];if(this.data.hierarchy[c].keys.length&&e){for(var g=0;g<e.length;g++){var h=e[g],k=this.getNextKeyWith(h,c,0);k&&k.apply(h)}f.matrixAutoUpdate=!1;this.data.hierarchy[c].node.updateMatrix();
f.matrixWorldNeedsUpdate=!0}}};
THREE.KeyFrameAnimation.prototype.play=function(b){this.currentTime=void 0!==b?b:0;if(!1===this.isPlaying){this.isPlaying=!0;var a=this.hierarchy.length,c,d;for(b=0;b<a;b++)c=this.hierarchy[b],d=this.data.hierarchy[b],void 0===d.animationCache&&(d.animationCache={},d.animationCache.prevKey=null,d.animationCache.nextKey=null,d.animationCache.originalMatrix=c instanceof THREE.Bone?c.skinMatrix:c.matrix),c=this.data.hierarchy[b].keys,c.length&&(d.animationCache.prevKey=c[0],d.animationCache.nextKey=
c[1],this.startTime=Math.min(c[0].time,this.startTime),this.endTime=Math.max(c[c.length-1].time,this.endTime));this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.data.hierarchy.length;b++){var a=this.hierarchy[b],c=this.data.hierarchy[b];if(void 0!==c.animationCache){var d=c.animationCache.originalMatrix;a instanceof THREE.Bone?(d.copy(a.skinMatrix),a.skinMatrix=d):(d.copy(a.matrix),a.matrix=d);delete c.animationCache}}};
THREE.KeyFrameAnimation.prototype.update=function(b){if(!1!==this.isPlaying){this.currentTime+=b*this.timeScale;b=this.data.length;!0===this.loop&&this.currentTime>b&&(this.currentTime%=b);this.currentTime=Math.min(this.currentTime,b);b=0;for(var a=this.hierarchy.length;b<a;b++){var c=this.hierarchy[b],d=this.data.hierarchy[b],e=d.keys,d=d.animationCache;if(e.length){var f=d.prevKey,g=d.nextKey;if(g.time<=this.currentTime){for(;g.time<this.currentTime&&g.index>f.index;)f=g,g=e[f.index+1];d.prevKey=
f;d.nextKey=g}g.time>=this.currentTime?f.interpolate(g,this.currentTime):f.interpolate(g,g.time);this.data.hierarchy[b].node.updateMatrix();c.matrixWorldNeedsUpdate=!0}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(b,a,c){a=this.data.hierarchy[a].keys;for(c%=a.length;c<a.length;c++)if(a[c].hasTarget(b))return a[c];return a[0]};
THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(b,a,c){a=this.data.hierarchy[a].keys;for(c=0<=c?c:c+a.length;0<=c;c--)if(a[c].hasTarget(b))return a[c];return a[a.length-1]};THREE.MorphAnimation=function(b){this.mesh=b;this.frames=b.morphTargetInfluences.length;this.currentTime=0;this.duration=1E3;this.loop=!0;this.isPlaying=!1};
THREE.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var b=0,a=0;return function(c){if(!1!==this.isPlaying){this.currentTime+=c;!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration);this.currentTime=Math.min(this.currentTime,this.duration);c=this.duration/this.frames;var d=Math.floor(this.currentTime/c);d!=a&&(this.mesh.morphTargetInfluences[b]=0,this.mesh.morphTargetInfluences[a]=1,this.mesh.morphTargetInfluences[d]=
0,b=a,a=d);this.mesh.morphTargetInfluences[d]=this.currentTime%c/c;this.mesh.morphTargetInfluences[b]=1-this.mesh.morphTargetInfluences[d]}}}()};THREE.CubeCamera=function(b,a,c){THREE.Object3D.call(this);var d=new THREE.PerspectiveCamera(90,1,b,a);d.up.set(0,-1,0);d.lookAt(new THREE.Vector3(1,0,0));this.add(d);var e=new THREE.PerspectiveCamera(90,1,b,a);e.up.set(0,-1,0);e.lookAt(new THREE.Vector3(-1,0,0));this.add(e);var f=new THREE.PerspectiveCamera(90,1,b,a);f.up.set(0,0,1);f.lookAt(new THREE.Vector3(0,1,0));this.add(f);var g=new THREE.PerspectiveCamera(90,1,b,a);g.up.set(0,0,-1);g.lookAt(new THREE.Vector3(0,-1,0));this.add(g);var h=new THREE.PerspectiveCamera(90,
1,b,a);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,1));this.add(h);var k=new THREE.PerspectiveCamera(90,1,b,a);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,-1));this.add(k);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){var c=this.renderTarget,r=c.generateMipmaps;c.generateMipmaps=!1;c.activeCubeFace=0;a.render(b,d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=
2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.generateMipmaps=r;c.activeCubeFace=5;a.render(b,k,c)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CombinedCamera=function(b,a,c,d,e,f,g){THREE.Camera.call(this);this.fov=c;this.left=-b/2;this.right=b/2;this.top=a/2;this.bottom=-a/2;this.cameraO=new THREE.OrthographicCamera(b/-2,b/2,a/2,a/-2,f,g);this.cameraP=new THREE.PerspectiveCamera(c,b/a,d,e);this.zoom=1;this.toPerspective()};THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype);
THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=!0;this.inOrthographicMode=!1};
THREE.CombinedCamera.prototype.toOrthographic=function(){var b=this.cameraP.aspect,a=(this.cameraP.near+this.cameraP.far)/2,a=Math.tan(this.fov/2)*a,b=2*a*b/2,a=a/this.zoom,b=b/this.zoom;this.cameraO.left=-b;this.cameraO.right=b;this.cameraO.top=a;this.cameraO.bottom=-a;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=!1;this.inOrthographicMode=!0};
THREE.CombinedCamera.prototype.setSize=function(b,a){this.cameraP.aspect=b/a;this.left=-b/2;this.right=b/2;this.top=a/2;this.bottom=-a/2};THREE.CombinedCamera.prototype.setFov=function(b){this.fov=b;this.inPerspectiveMode?this.toPerspective():this.toOrthographic()};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())};
THREE.CombinedCamera.prototype.setLens=function(b,a){void 0===a&&(a=24);var c=2*THREE.Math.radToDeg(Math.atan(a/(2*b)));this.setFov(c);return c};THREE.CombinedCamera.prototype.setZoom=function(b){this.zoom=b;this.inPerspectiveMode?this.toPerspective():this.toOrthographic()};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};
THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=!1};THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};
THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};THREE.BoxGeometry=function(b,a,c,d,e,f){function g(a,b,c,d,e,f,g,m){var u,v=h.widthSegments,t=h.heightSegments,E=e/2,y=f/2,x=h.vertices.length;if("x"===a&&"y"===b||"y"===a&&"x"===b)u="z";else if("x"===a&&"z"===b||"z"===a&&"x"===b)u="y",t=h.depthSegments;else if("z"===a&&"y"===b||"y"===a&&"z"===b)u="x",v=h.depthSegments;var w=v+1,B=t+1,A=e/v,z=f/t,G=new THREE.Vector3;G[u]=0<g?1:-1;for(e=0;e<B;e++)for(f=0;f<w;f++){var F=new THREE.Vector3;F[a]=(f*A-E)*c;F[b]=(e*z-y)*d;F[u]=g;h.vertices.push(F)}for(e=
0;e<t;e++)for(f=0;f<v;f++)y=f+w*e,a=f+w*(e+1),b=f+1+w*(e+1),c=f+1+w*e,d=new THREE.Vector2(f/v,1-e/t),g=new THREE.Vector2(f/v,1-(e+1)/t),u=new THREE.Vector2((f+1)/v,1-(e+1)/t),E=new THREE.Vector2((f+1)/v,1-e/t),y=new THREE.Face3(y+x,a+x,c+x),y.normal.copy(G),y.vertexNormals.push(G.clone(),G.clone(),G.clone()),y.materialIndex=m,h.faces.push(y),h.faceVertexUvs[0].push([d,g,E]),y=new THREE.Face3(a+x,b+x,c+x),y.normal.copy(G),y.vertexNormals.push(G.clone(),G.clone(),G.clone()),y.materialIndex=m,h.faces.push(y),
h.faceVertexUvs[0].push([g.clone(),u,E.clone()])}THREE.Geometry.call(this);this.parameters={width:b,height:a,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.widthSegments=d||1;this.heightSegments=e||1;this.depthSegments=f||1;var h=this;d=b/2;e=a/2;f=c/2;g("z","y",-1,-1,c,a,d,0);g("z","y",1,-1,c,a,-d,1);g("x","z",1,1,b,c,e,2);g("x","z",1,-1,b,c,-e,3);g("x","y",1,-1,b,a,f,4);g("x","y",-1,-1,b,a,-f,5);this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry=function(b,a,c,d){this.parameters={radius:b,segments:a,thetaStart:c,thetaLength:d};b=b||50;a=void 0!==a?Math.max(3,a):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e=a+2,f=new Uint16Array(3*a),g=new Float32Array(3*e),h=new Float32Array(3*e),e=new Float32Array(2*e);h[2]=1;e[0]=0.5;e[1]=0.5;for(var k=0,l=2,n=3,p=0;p<=a;p++){var r=c+p/a*d,q=b*Math.cos(r),r=b*Math.sin(r);g[n]=q;g[n+1]=r;h[n+2]=1;e[l]=(q/b+1)/2;e[l+1]=(r/b+1)/2;l+=2;n+=3;f[k]=0;f[k+1]=p+1;f[k+2]=p+2;k+=3}THREE.IndexedGeometry2.call(this);
this.setArrays(f,g,h,e);this.boundingSphere=new THREE.Sphere(new THREE.Vector3,b)};THREE.CircleGeometry.prototype=Object.create(THREE.IndexedGeometry2.prototype);THREE.CubeGeometry=function(b,a,c,d,e,f){console.warn("DEPRECATED: THREE.CubeGeometry is deprecated. Use THREE.BoxGeometry instead.");return new THREE.BoxGeometry(b,a,c,d,e,f)};THREE.CylinderGeometry=function(b,a,c,d,e,f){THREE.Geometry.call(this);this.parameters={radiusTop:b,radiusBottom:a,height:c,radialSegments:d,heightSegments:e,openEnded:f};b=void 0!==b?b:20;a=void 0!==a?a:20;c=void 0!==c?c:100;d=d||8;e=e||1;f=void 0!==f?f:!1;var g=c/2,h,k,l=[],n=[];for(k=0;k<=e;k++){var p=[],r=[],q=k/e,s=q*(a-b)+b;for(h=0;h<=d;h++){var m=h/d,u=new THREE.Vector3;u.x=s*Math.sin(m*Math.PI*2);u.y=-q*c+g;u.z=s*Math.cos(m*Math.PI*2);this.vertices.push(u);p.push(this.vertices.length-1);r.push(new THREE.Vector2(m,
1-q))}l.push(p);n.push(r)}c=(a-b)/c;for(h=0;h<d;h++)for(0!==b?(p=this.vertices[l[0][h]].clone(),r=this.vertices[l[0][h+1]].clone()):(p=this.vertices[l[1][h]].clone(),r=this.vertices[l[1][h+1]].clone()),p.setY(Math.sqrt(p.x*p.x+p.z*p.z)*c).normalize(),r.setY(Math.sqrt(r.x*r.x+r.z*r.z)*c).normalize(),k=0;k<e;k++){var q=l[k][h],s=l[k+1][h],m=l[k+1][h+1],u=l[k][h+1],v=p.clone(),t=p.clone(),E=r.clone(),y=r.clone(),x=n[k][h].clone(),w=n[k+1][h].clone(),B=n[k+1][h+1].clone(),A=n[k][h+1].clone();this.faces.push(new THREE.Face3(q,
s,u,[v,t,y]));this.faceVertexUvs[0].push([x,w,A]);this.faces.push(new THREE.Face3(s,m,u,[t.clone(),E,y.clone()]));this.faceVertexUvs[0].push([w.clone(),B,A.clone()])}if(!1===f&&0<b)for(this.vertices.push(new THREE.Vector3(0,g,0)),h=0;h<d;h++)q=l[0][h],s=l[0][h+1],m=this.vertices.length-1,v=new THREE.Vector3(0,1,0),t=new THREE.Vector3(0,1,0),E=new THREE.Vector3(0,1,0),x=n[0][h].clone(),w=n[0][h+1].clone(),B=new THREE.Vector2(w.x,0),this.faces.push(new THREE.Face3(q,s,m,[v,t,E])),this.faceVertexUvs[0].push([x,
w,B]);if(!1===f&&0<a)for(this.vertices.push(new THREE.Vector3(0,-g,0)),h=0;h<d;h++)q=l[k][h+1],s=l[k][h],m=this.vertices.length-1,v=new THREE.Vector3(0,-1,0),t=new THREE.Vector3(0,-1,0),E=new THREE.Vector3(0,-1,0),x=n[k][h+1].clone(),w=n[k][h].clone(),B=new THREE.Vector2(w.x,1),this.faces.push(new THREE.Face3(q,s,m,[v,t,E])),this.faceVertexUvs[0].push([x,w,B]);this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry=function(b,a){"undefined"!==typeof b&&(THREE.Geometry.call(this),b=b instanceof Array?b:[b],this.shapebb=b[b.length-1].getBoundingBox(),this.addShapeList(b,a),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(b,a){for(var c=b.length,d=0;d<c;d++)this.addShape(b[d],a)};
THREE.ExtrudeGeometry.prototype.addShape=function(b,a){function c(a,b,c){b||console.log("die");return b.clone().multiplyScalar(c).add(a)}function d(a,b,c){var d=THREE.Math.sign,e=1,e=a.x-b.x,f=a.y-b.y,g=c.x-a.x,k=c.y-a.y,h=e*e+f*f;if(1E-10<Math.abs(e*k-f*g)){var l=Math.sqrt(h),d=Math.sqrt(g*g+k*k),h=b.x-f/l;b=b.y+e/l;g=((c.x-k/d-h)*k-(c.y+g/d-b)*g)/(e*k-f*g);c=h+e*g-a.x;a=b+f*g-a.y;e=c*c+a*a;if(2>=e)return new THREE.Vector2(c,a);e=Math.sqrt(e/2)}else a=!1,1E-10<e?1E-10<g&&(a=!0):-1E-10>e?-1E-10>g&&
(a=!0):d(f)==d(k)&&(a=!0),a?(c=-f,a=e,e=Math.sqrt(h)):(c=e,a=f,e=Math.sqrt(h/2));return new THREE.Vector2(c/e,a/e)}function e(c,d){var e,f;for(C=c.length;0<=--C;){e=C;f=C-1;0>f&&(f=c.length-1);for(var g=0,k=q+2*n,g=0;g<k;g++){var h=P*g,l=P*(g+1),m=d+e+h,h=d+f+h,p=d+f+l,l=d+e+l,r=c,s=g,u=k,v=e,x=f,m=m+K,h=h+K,p=p+K,l=l+K;F.faces.push(new THREE.Face3(m,h,l,null,null,t));F.faces.push(new THREE.Face3(h,p,l,null,null,t));m=E.generateSideWallUV(F,b,r,a,m,h,p,l,s,u,v,x);F.faceVertexUvs[0].push([m[0],m[1],
m[3]]);F.faceVertexUvs[0].push([m[1],m[2],m[3]])}}}function f(a,b,c){F.vertices.push(new THREE.Vector3(a,b,c))}function g(c,d,e,f){c+=K;d+=K;e+=K;F.faces.push(new THREE.Face3(c,d,e,null,null,v));c=f?E.generateBottomUV(F,b,a,c,d,e):E.generateTopUV(F,b,a,c,d,e);F.faceVertexUvs[0].push(c)}var h=void 0!==a.amount?a.amount:100,k=void 0!==a.bevelThickness?a.bevelThickness:6,l=void 0!==a.bevelSize?a.bevelSize:k-2,n=void 0!==a.bevelSegments?a.bevelSegments:3,p=void 0!==a.bevelEnabled?a.bevelEnabled:!0,r=
void 0!==a.curveSegments?a.curveSegments:12,q=void 0!==a.steps?a.steps:1,s=a.extrudePath,m,u=!1,v=a.material,t=a.extrudeMaterial,E=void 0!==a.UVGenerator?a.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,y,x,w,B;s&&(m=s.getSpacedPoints(q),u=!0,p=!1,y=void 0!==a.frames?a.frames:new THREE.TubeGeometry.FrenetFrames(s,q,!1),x=new THREE.Vector3,w=new THREE.Vector3,B=new THREE.Vector3);p||(l=k=n=0);var A,z,G,F=this,K=this.vertices.length,s=b.extractPoints(r),r=s.shape,H=s.holes;if(s=!THREE.Shape.Utils.isClockWise(r)){r=
r.reverse();z=0;for(G=H.length;z<G;z++)A=H[z],THREE.Shape.Utils.isClockWise(A)&&(H[z]=A.reverse());s=!1}var N=THREE.Shape.Utils.triangulateShape(r,H),L=r;z=0;for(G=H.length;z<G;z++)A=H[z],r=r.concat(A);var D,I,J,R,M,P=r.length,O,S=N.length,s=[],C=0;J=L.length;D=J-1;for(I=C+1;C<J;C++,D++,I++)D===J&&(D=0),I===J&&(I=0),s[C]=d(L[C],L[D],L[I]);var U=[],Q,T=s.concat();z=0;for(G=H.length;z<G;z++){A=H[z];Q=[];C=0;J=A.length;D=J-1;for(I=C+1;C<J;C++,D++,I++)D===J&&(D=0),I===J&&(I=0),Q[C]=d(A[C],A[D],A[I]);
U.push(Q);T=T.concat(Q)}for(D=0;D<n;D++){J=D/n;R=k*(1-J);I=l*Math.sin(J*Math.PI/2);C=0;for(J=L.length;C<J;C++)M=c(L[C],s[C],I),f(M.x,M.y,-R);z=0;for(G=H.length;z<G;z++)for(A=H[z],Q=U[z],C=0,J=A.length;C<J;C++)M=c(A[C],Q[C],I),f(M.x,M.y,-R)}I=l;for(C=0;C<P;C++)M=p?c(r[C],T[C],I):r[C],u?(w.copy(y.normals[0]).multiplyScalar(M.x),x.copy(y.binormals[0]).multiplyScalar(M.y),B.copy(m[0]).add(w).add(x),f(B.x,B.y,B.z)):f(M.x,M.y,0);for(J=1;J<=q;J++)for(C=0;C<P;C++)M=p?c(r[C],T[C],I):r[C],u?(w.copy(y.normals[J]).multiplyScalar(M.x),
x.copy(y.binormals[J]).multiplyScalar(M.y),B.copy(m[J]).add(w).add(x),f(B.x,B.y,B.z)):f(M.x,M.y,h/q*J);for(D=n-1;0<=D;D--){J=D/n;R=k*(1-J);I=l*Math.sin(J*Math.PI/2);C=0;for(J=L.length;C<J;C++)M=c(L[C],s[C],I),f(M.x,M.y,h+R);z=0;for(G=H.length;z<G;z++)for(A=H[z],Q=U[z],C=0,J=A.length;C<J;C++)M=c(A[C],Q[C],I),u?f(M.x,M.y+m[q-1].y,m[q-1].x+R):f(M.x,M.y,h+R)}(function(){if(p){var a;a=0*P;for(C=0;C<S;C++)O=N[C],g(O[2]+a,O[1]+a,O[0]+a,!0);a=q+2*n;a*=P;for(C=0;C<S;C++)O=N[C],g(O[0]+a,O[1]+a,O[2]+a,!1)}else{for(C=
0;C<S;C++)O=N[C],g(O[2],O[1],O[0],!0);for(C=0;C<S;C++)O=N[C],g(O[0]+P*q,O[1]+P*q,O[2]+P*q,!1)}})();(function(){var a=0;e(L,a);a+=L.length;z=0;for(G=H.length;z<G;z++)A=H[z],e(A,a),a+=A.length})()};
THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(b,a,c,d,e,f){a=b.vertices[e].x;e=b.vertices[e].y;c=b.vertices[f].x;f=b.vertices[f].y;return[new THREE.Vector2(b.vertices[d].x,b.vertices[d].y),new THREE.Vector2(a,e),new THREE.Vector2(c,f)]},generateBottomUV:function(b,a,c,d,e,f){return this.generateTopUV(b,a,c,d,e,f)},generateSideWallUV:function(b,a,c,d,e,f,g,h,k,l,n,p){a=b.vertices[e].x;c=b.vertices[e].y;e=b.vertices[e].z;d=b.vertices[f].x;k=b.vertices[f].y;f=b.vertices[f].z;l=b.vertices[g].x;
n=b.vertices[g].y;g=b.vertices[g].z;p=b.vertices[h].x;var r=b.vertices[h].y;b=b.vertices[h].z;return 0.01>Math.abs(c-k)?[new THREE.Vector2(a,1-e),new THREE.Vector2(d,1-f),new THREE.Vector2(l,1-g),new THREE.Vector2(p,1-b)]:[new THREE.Vector2(c,1-e),new THREE.Vector2(k,1-f),new THREE.Vector2(n,1-g),new THREE.Vector2(r,1-b)]}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2;THREE.ExtrudeGeometry.__v2=new THREE.Vector2;THREE.ExtrudeGeometry.__v3=new THREE.Vector2;THREE.ExtrudeGeometry.__v4=new THREE.Vector2;
THREE.ExtrudeGeometry.__v5=new THREE.Vector2;THREE.ExtrudeGeometry.__v6=new THREE.Vector2;THREE.ShapeGeometry=function(b,a){THREE.Geometry.call(this);!1===b instanceof Array&&(b=[b]);this.shapebb=b[b.length-1].getBoundingBox();this.addShapeList(b,a);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(b,a){for(var c=0,d=b.length;c<d;c++)this.addShape(b[c],a);return this};
THREE.ShapeGeometry.prototype.addShape=function(b,a){void 0===a&&(a={});var c=a.material,d=void 0===a.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:a.UVGenerator,e,f,g,h=this.vertices.length;e=b.extractPoints(void 0!==a.curveSegments?a.curveSegments:12);var k=e.shape,l=e.holes;if(!THREE.Shape.Utils.isClockWise(k))for(k=k.reverse(),e=0,f=l.length;e<f;e++)g=l[e],THREE.Shape.Utils.isClockWise(g)&&(l[e]=g.reverse());var n=THREE.Shape.Utils.triangulateShape(k,l);e=0;for(f=l.length;e<f;e++)g=l[e],
k=k.concat(g);l=k.length;f=n.length;for(e=0;e<l;e++)g=k[e],this.vertices.push(new THREE.Vector3(g.x,g.y,0));for(e=0;e<f;e++)l=n[e],k=l[0]+h,g=l[1]+h,l=l[2]+h,this.faces.push(new THREE.Face3(k,g,l,null,null,c)),this.faceVertexUvs[0].push(d.generateBottomUV(this,b,a,k,g,l))};THREE.LatheGeometry=function(b,a,c,d){THREE.Geometry.call(this);a=a||12;c=c||0;d=d||2*Math.PI;for(var e=1/(b.length-1),f=1/a,g=0,h=a;g<=h;g++)for(var k=c+g*f*d,l=Math.cos(k),n=Math.sin(k),k=0,p=b.length;k<p;k++){var r=b[k],q=new THREE.Vector3;q.x=l*r.x-n*r.y;q.y=n*r.x+l*r.y;q.z=r.z;this.vertices.push(q)}c=b.length;g=0;for(h=a;g<h;g++)for(k=0,p=b.length-1;k<p;k++){a=n=k+c*g;d=n+c;var l=n+1+c,n=n+1,r=g*f,q=k*e,s=r+f,m=q+e;this.faces.push(new THREE.Face3(a,d,n));this.faceVertexUvs[0].push([new THREE.Vector2(r,
q),new THREE.Vector2(s,q),new THREE.Vector2(r,m)]);this.faces.push(new THREE.Face3(d,l,n));this.faceVertexUvs[0].push([new THREE.Vector2(s,q),new THREE.Vector2(s,m),new THREE.Vector2(r,m)])}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry=function(b,a,c,d){this.parameters={width:b,height:a,widthSegments:c,heightSegments:d};var e=b/2,f=a/2;c=c||1;d=d||1;var g=c+1,h=d+1,k=b/c,l=a/d;a=new Float32Array(g*h*3);b=new Float32Array(g*h*3);for(var n=new Float32Array(g*h*2),p=0,r=0,q=0;q<h;q++)for(var s=q*l-f,m=0;m<g;m++)a[p]=m*k-e,a[p+1]=-s,b[p+2]=1,n[r]=m/c,n[r+1]=1-q/d,p+=3,r+=2;p=0;e=new (65535<a.length?Uint32Array:Uint16Array)(c*d*6);for(q=0;q<d;q++)for(m=0;m<c;m++)f=m+g*(q+1),h=m+1+g*(q+1),k=m+1+g*q,e[p]=m+g*q,e[p+
1]=f,e[p+2]=k,e[p+3]=f,e[p+4]=h,e[p+5]=k,p+=6;THREE.IndexedGeometry2.call(this);this.setArrays(e,a,b,n);this.computeBoundingSphere()};THREE.PlaneGeometry.prototype=Object.create(THREE.IndexedGeometry2.prototype);THREE.RingGeometry=function(b,a,c,d,e,f){THREE.Geometry.call(this);b=b||0;a=a||50;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(3,d):8;var g,h=[],k=b,l=(a-b)/d;for(b=0;b<=d;b++){for(g=0;g<=c;g++){var n=new THREE.Vector3,p=e+g/c*f;n.x=k*Math.cos(p);n.y=k*Math.sin(p);this.vertices.push(n);h.push(new THREE.Vector2((n.x/a+1)/2,(n.y/a+1)/2))}k+=l}a=new THREE.Vector3(0,0,1);for(b=0;b<d;b++)for(e=b*c,g=0;g<=c;g++)p=g+e,f=p+b,l=p+c+b,n=p+c+1+b,this.faces.push(new THREE.Face3(f,
l,n,[a.clone(),a.clone(),a.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[l].clone(),h[n].clone()]),f=p+b,l=p+c+1+b,n=p+1+b,this.faces.push(new THREE.Face3(f,l,n,[a.clone(),a.clone(),a.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[l].clone(),h[n].clone()]);this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,k)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry=function(b,a,c,d,e,f,g){THREE.Geometry.call(this);this.parameters={radius:b,widthSegments:a,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};b=b||50;a=Math.max(3,Math.floor(a)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;var h,k,l=[],n=[];for(k=0;k<=c;k++){var p=[],r=[];for(h=0;h<=a;h++){var q=h/a,s=k/c,m=new THREE.Vector3;m.x=-b*Math.cos(d+q*e)*Math.sin(f+s*g);m.y=b*Math.cos(f+s*g);m.z=
b*Math.sin(d+q*e)*Math.sin(f+s*g);this.vertices.push(m);p.push(this.vertices.length-1);r.push(new THREE.Vector2(q,1-s))}l.push(p);n.push(r)}for(k=0;k<c;k++)for(h=0;h<a;h++){d=l[k][h+1];e=l[k][h];f=l[k+1][h];g=l[k+1][h+1];var p=this.vertices[d].clone().normalize(),r=this.vertices[e].clone().normalize(),q=this.vertices[f].clone().normalize(),s=this.vertices[g].clone().normalize(),m=n[k][h+1].clone(),u=n[k][h].clone(),v=n[k+1][h].clone(),t=n[k+1][h+1].clone();Math.abs(this.vertices[d].y)===b?(m.x=(m.x+
u.x)/2,this.faces.push(new THREE.Face3(d,f,g,[p,q,s])),this.faceVertexUvs[0].push([m,v,t])):Math.abs(this.vertices[f].y)===b?(v.x=(v.x+t.x)/2,this.faces.push(new THREE.Face3(d,e,f,[p,r,q])),this.faceVertexUvs[0].push([m,u,v])):(this.faces.push(new THREE.Face3(d,e,g,[p,r,s])),this.faceVertexUvs[0].push([m,u,t]),this.faces.push(new THREE.Face3(e,f,g,[r.clone(),q,s.clone()])),this.faceVertexUvs[0].push([u.clone(),v,t.clone()]))}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,
b)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(b,a){a=a||{};var c=THREE.FontUtils.generateShapes(b,a);a.amount=void 0!==a.height?a.height:50;void 0===a.bevelThickness&&(a.bevelThickness=10);void 0===a.bevelSize&&(a.bevelSize=8);void 0===a.bevelEnabled&&(a.bevelEnabled=!1);THREE.ExtrudeGeometry.call(this,c,a)};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TorusGeometry=function(b,a,c,d,e){THREE.Geometry.call(this);this.parameters={radius:b,tube:a,radialSegments:c,tubularSegments:d,arc:e};b=b||100;a=a||40;c=c||8;d=d||6;e=e||2*Math.PI;for(var f=new THREE.Vector3,g=[],h=[],k=0;k<=c;k++)for(var l=0;l<=d;l++){var n=l/d*e,p=k/c*Math.PI*2;f.x=b*Math.cos(n);f.y=b*Math.sin(n);var r=new THREE.Vector3;r.x=(b+a*Math.cos(p))*Math.cos(n);r.y=(b+a*Math.cos(p))*Math.sin(n);r.z=a*Math.sin(p);this.vertices.push(r);g.push(new THREE.Vector2(l/d,k/c));h.push(r.clone().sub(f).normalize())}for(k=
1;k<=c;k++)for(l=1;l<=d;l++)b=(d+1)*k+l-1,a=(d+1)*(k-1)+l-1,e=(d+1)*(k-1)+l,f=(d+1)*k+l,n=new THREE.Face3(b,a,f,[h[b].clone(),h[a].clone(),h[f].clone()]),this.faces.push(n),this.faceVertexUvs[0].push([g[b].clone(),g[a].clone(),g[f].clone()]),n=new THREE.Face3(a,e,f,[h[a].clone(),h[e].clone(),h[f].clone()]),this.faces.push(n),this.faceVertexUvs[0].push([g[a].clone(),g[e].clone(),g[f].clone()]);this.computeFaceNormals()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry=function(b,a,c,d,e,f,g){function h(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a);a*=b/c;b=Math.cos(a);f*=d*(2+b)*0.5;g=d*(2+b)*g*0.5;d=e*d*Math.sin(a)*0.5;return new THREE.Vector3(f,g,d)}THREE.Geometry.call(this);this.parameters={radius:b,tube:a,radialSegments:c,tubularSegments:d,p:e,q:f,heightScale:g};b=b||100;a=a||40;c=c||64;d=d||8;e=e||2;f=f||3;g=g||1;for(var k=Array(c),l=new THREE.Vector3,n=new THREE.Vector3,p=new THREE.Vector3,r=0;r<c;++r){k[r]=Array(d);var q=r/c*2*e*Math.PI,
s=h(q,f,e,b,g),q=h(q+0.01,f,e,b,g);l.subVectors(q,s);n.addVectors(q,s);p.crossVectors(l,n);n.crossVectors(p,l);p.normalize();n.normalize();for(q=0;q<d;++q){var m=q/d*2*Math.PI,u=-a*Math.cos(m),m=a*Math.sin(m),v=new THREE.Vector3;v.x=s.x+u*n.x+m*p.x;v.y=s.y+u*n.y+m*p.y;v.z=s.z+u*n.z+m*p.z;k[r][q]=this.vertices.push(v)-1}}for(r=0;r<c;++r)for(q=0;q<d;++q)e=(r+1)%c,f=(q+1)%d,b=k[r][q],a=k[e][q],e=k[e][f],f=k[r][f],g=new THREE.Vector2(r/c,q/d),l=new THREE.Vector2((r+1)/c,q/d),n=new THREE.Vector2((r+1)/
c,(q+1)/d),p=new THREE.Vector2(r/c,(q+1)/d),this.faces.push(new THREE.Face3(b,a,f)),this.faceVertexUvs[0].push([g,l,p]),this.faces.push(new THREE.Face3(a,e,f)),this.faceVertexUvs[0].push([l.clone(),n,p.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry=function(b,a,c,d,e){THREE.Geometry.call(this);this.parameters={path:b,segments:a,radius:c,radialSegments:d,closed:e};a=a||64;c=c||1;d=d||8;e=e||!1;var f=[],g,h,k=a+1,l,n,p,r,q=new THREE.Vector3,s,m,u;s=new THREE.TubeGeometry.FrenetFrames(b,a,e);m=s.normals;u=s.binormals;this.tangents=s.tangents;this.normals=m;this.binormals=u;for(s=0;s<k;s++)for(f[s]=[],l=s/(k-1),r=b.getPointAt(l),g=m[s],h=u[s],l=0;l<d;l++)n=l/d*2*Math.PI,p=-c*Math.cos(n),n=c*Math.sin(n),q.copy(r),q.x+=p*g.x+n*
h.x,q.y+=p*g.y+n*h.y,q.z+=p*g.z+n*h.z,f[s][l]=this.vertices.push(new THREE.Vector3(q.x,q.y,q.z))-1;for(s=0;s<a;s++)for(l=0;l<d;l++)k=e?(s+1)%a:s+1,q=(l+1)%d,b=f[s][l],c=f[k][l],k=f[k][q],q=f[s][q],m=new THREE.Vector2(s/a,l/d),u=new THREE.Vector2((s+1)/a,l/d),g=new THREE.Vector2((s+1)/a,(l+1)/d),h=new THREE.Vector2(s/a,(l+1)/d),this.faces.push(new THREE.Face3(b,c,q)),this.faceVertexUvs[0].push([m,u,h]),this.faces.push(new THREE.Face3(c,k,q)),this.faceVertexUvs[0].push([u.clone(),g,h.clone()]);this.computeFaceNormals();
this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.TubeGeometry.FrenetFrames=function(b,a,c){new THREE.Vector3;var d=new THREE.Vector3;new THREE.Vector3;var e=[],f=[],g=[],h=new THREE.Vector3,k=new THREE.Matrix4;a+=1;var l,n,p;this.tangents=e;this.normals=f;this.binormals=g;for(l=0;l<a;l++)n=l/(a-1),e[l]=b.getTangentAt(n),e[l].normalize();f[0]=new THREE.Vector3;g[0]=new THREE.Vector3;b=Number.MAX_VALUE;l=Math.abs(e[0].x);n=Math.abs(e[0].y);p=Math.abs(e[0].z);l<=b&&(b=l,d.set(1,0,0));n<=b&&(b=n,d.set(0,1,0));p<=b&&d.set(0,0,1);h.crossVectors(e[0],
d).normalize();f[0].crossVectors(e[0],h);g[0].crossVectors(e[0],f[0]);for(l=1;l<a;l++)f[l]=f[l-1].clone(),g[l]=g[l-1].clone(),h.crossVectors(e[l-1],e[l]),1E-4<h.length()&&(h.normalize(),d=Math.acos(THREE.Math.clamp(e[l-1].dot(e[l]),-1,1)),f[l].applyMatrix4(k.makeRotationAxis(h,d))),g[l].crossVectors(e[l],f[l]);if(c)for(d=Math.acos(THREE.Math.clamp(f[0].dot(f[a-1]),-1,1)),d/=a-1,0<e[0].dot(h.crossVectors(f[0],f[a-1]))&&(d=-d),l=1;l<a;l++)f[l].applyMatrix4(k.makeRotationAxis(e[l],d*l)),g[l].crossVectors(e[l],
f[l])};THREE.PolyhedronGeometry=function(b,a,c,d){function e(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+0.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+0.5;b.uv=new THREE.Vector2(c,1-a);return b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d);u.copy(a).add(b).add(c).divideScalar(3);d=Math.atan2(u.z,-u.x);k.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function g(a,
b){var c=Math.pow(2,b);Math.pow(4,b);for(var d=e(k.vertices[a.a]),g=e(k.vertices[a.b]),h=e(k.vertices[a.c]),l=[],m=0;m<=c;m++){l[m]=[];for(var n=e(d.clone().lerp(h,m/c)),p=e(g.clone().lerp(h,m/c)),r=c-m,q=0;q<=r;q++)l[m][q]=0==q&&m==c?n:e(n.clone().lerp(p,q/r))}for(m=0;m<c;m++)for(q=0;q<2*(c-m)-1;q++)d=Math.floor(q/2),0==q%2?f(l[m][d+1],l[m+1][d],l[m][d]):f(l[m][d+1],l[m+1][d+1],l[m+1][d])}function h(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/
Math.PI+0.5,a.y));return a.clone()}THREE.Geometry.call(this);c=c||1;d=d||0;for(var k=this,l=0,n=b.length;l<n;l+=3)e(new THREE.Vector3(b[l],b[l+1],b[l+2]));b=this.vertices;for(var p=[],r=l=0,n=a.length;l<n;l+=3,r++){var q=b[a[l]],s=b[a[l+1]],m=b[a[l+2]];p[r]=new THREE.Face3(q.index,s.index,m.index,[q.clone(),s.clone(),m.clone()])}for(var u=new THREE.Vector3,l=0,n=p.length;l<n;l++)g(p[l],d);l=0;for(n=this.faceVertexUvs[0].length;l<n;l++)a=this.faceVertexUvs[0][l],d=a[0].x,b=a[1].x,p=a[2].x,r=Math.max(d,
Math.max(b,p)),q=Math.min(d,Math.min(b,p)),0.9<r&&0.1>q&&(0.2>d&&(a[0].x+=1),0.2>b&&(a[1].x+=1),0.2>p&&(a[2].x+=1));l=0;for(n=this.vertices.length;l<n;l++)this.vertices[l].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry=function(b,a){this.parameters={radius:b,detail:a};var c=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],b,a)};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry=function(b,a){this.parameters={radius:b,detail:a};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],b,a)};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry=function(b,a){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],b,a)};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry=function(b,a,c){THREE.Geometry.call(this);var d=this.vertices,e=this.faces,f=this.faceVertexUvs[0],g,h,k,l,n=a+1;for(g=0;g<=c;g++)for(l=g/c,h=0;h<=a;h++)k=h/a,k=b(k,l),d.push(k);var p,r,q,s;for(g=0;g<c;g++)for(h=0;h<a;h++)b=g*n+h,d=g*n+h+1,l=(g+1)*n+h+1,k=(g+1)*n+h,p=new THREE.Vector2(h/a,g/c),r=new THREE.Vector2((h+1)/a,g/c),q=new THREE.Vector2((h+1)/a,(g+1)/c),s=new THREE.Vector2(h/a,(g+1)/c),e.push(new THREE.Face3(b,d,k)),f.push([p,r,s]),e.push(new THREE.Face3(d,l,k)),
f.push([r.clone(),q,s.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.AxisHelper=function(b){b=b||1;var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3,new THREE.Vector3(b,0,0),new THREE.Vector3,new THREE.Vector3(0,b,0),new THREE.Vector3,new THREE.Vector3(0,0,b));a.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,a,b,THREE.LinePieces)};
THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.ArrowHelper=function(b,a,c,d,e,f){THREE.Object3D.call(this);void 0===d&&(d=16776960);void 0===c&&(c=1);void 0===e&&(e=0.2*c);void 0===f&&(f=0.2*e);this.position=a;a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(0,1,0));this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:d}));this.line.matrixAutoUpdate=!1;this.add(this.line);a=new THREE.CylinderGeometry(0,0.5,1,5,1);a.applyMatrix((new THREE.Matrix4).makeTranslation(0,-0.5,0));this.cone=
new THREE.Mesh(a,new THREE.MeshBasicMaterial({color:d}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(b);this.setLength(c,e,f)};THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.setDirection=function(){var b=new THREE.Vector3,a;return function(c){0.99999<c.y?this.quaternion.set(0,0,0,1):-0.99999>c.y?this.quaternion.set(1,0,0,0):(b.set(c.z,0,-c.x).normalize(),a=Math.acos(c.y),this.quaternion.setFromAxisAngle(b,a))}}();
THREE.ArrowHelper.prototype.setLength=function(b,a,c){void 0===a&&(a=0.2*b);void 0===c&&(c=0.2*a);this.line.scale.set(1,b,1);this.line.updateMatrix();this.cone.scale.set(c,a,c);this.cone.position.y=b;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(b){this.line.material.color.setHex(b);this.cone.material.color.setHex(b)};THREE.BoxHelper=function(b){var a=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(-1,-1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,-1,-1)];this.vertices=a;var c=new THREE.Geometry;c.vertices.push(a[0],a[1],a[1],a[2],a[2],a[3],a[3],a[0],a[4],a[5],a[5],a[6],a[6],a[7],a[7],a[4],a[0],a[4],a[1],a[5],a[2],a[6],a[3],a[7]);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);
void 0!==b&&this.update(b)};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);
THREE.BoxHelper.prototype.update=function(b){var a=b.geometry;null===a.boundingBox&&a.computeBoundingBox();var c=a.boundingBox.min,a=a.boundingBox.max,d=this.vertices;d[0].set(a.x,a.y,a.z);d[1].set(c.x,a.y,a.z);d[2].set(c.x,c.y,a.z);d[3].set(a.x,c.y,a.z);d[4].set(a.x,a.y,c.z);d[5].set(c.x,a.y,c.z);d[6].set(c.x,c.y,c.z);d[7].set(a.x,c.y,c.z);this.geometry.computeBoundingSphere();this.geometry.verticesNeedUpdate=!0;this.matrixAutoUpdate=!1;this.matrixWorld=b.matrixWorld};THREE.BoundingBoxHelper=function(b,a){var c=void 0!==a?a:8947848;this.object=b;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};THREE.CameraHelper=function(b){function a(a,b,d){c(a,d);c(b,d)}function c(a,b){d.vertices.push(new THREE.Vector3);d.colors.push(new THREE.Color(b));void 0===f[a]&&(f[a]=[]);f[a].push(d.vertices.length-1)}var d=new THREE.Geometry,e=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),f={};a("n1","n2",16755200);a("n2","n4",16755200);a("n4","n3",16755200);a("n3","n1",16755200);a("f1","f2",16755200);a("f2","f4",16755200);a("f4","f3",16755200);a("f3","f1",16755200);a("n1","f1",16755200);
a("n2","f2",16755200);a("n3","f3",16755200);a("n4","f4",16755200);a("p","n1",16711680);a("p","n2",16711680);a("p","n3",16711680);a("p","n4",16711680);a("u1","u2",43775);a("u2","u3",43775);a("u3","u1",43775);a("c","t",16777215);a("p","c",3355443);a("cn1","cn2",3355443);a("cn3","cn4",3355443);a("cf1","cf2",3355443);a("cf3","cf4",3355443);THREE.Line.call(this,d,e,THREE.LinePieces);this.camera=b;this.matrixWorld=b.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=f;this.update()};
THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);
THREE.CameraHelper.prototype.update=function(){var b=new THREE.Vector3,a=new THREE.Camera,c=new THREE.Projector;return function(){function d(d,g,h,k){b.set(g,h,k);c.unprojectVector(b,a);d=e.pointMap[d];if(void 0!==d)for(g=0,h=d.length;g<h;g++)e.geometry.vertices[d[g]].copy(b)}var e=this;a.projectionMatrix.copy(this.camera.projectionMatrix);d("c",0,0,-1);d("t",0,0,1);d("n1",-1,-1,-1);d("n2",1,-1,-1);d("n3",-1,1,-1);d("n4",1,1,-1);d("f1",-1,-1,1);d("f2",1,-1,1);d("f3",-1,1,1);d("f4",1,1,1);d("u1",0.7,
1.1,-1);d("u2",-0.7,1.1,-1);d("u3",0,2,-1);d("cf1",-1,0,1);d("cf2",1,0,1);d("cf3",0,-1,1);d("cf4",0,1,1);d("cn1",-1,0,-1);d("cn2",1,0,-1);d("cn3",0,-1,-1);d("cn4",0,1,-1);this.geometry.verticesNeedUpdate=!0}}();THREE.DirectionalLightHelper=function(b,a){THREE.Object3D.call(this);this.light=b;this.light.updateMatrixWorld();this.matrixWorld=b.matrixWorld;this.matrixAutoUpdate=!1;a=a||1;var c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(-a,a,0),new THREE.Vector3(a,a,0),new THREE.Vector3(a,-a,0),new THREE.Vector3(-a,-a,0),new THREE.Vector3(-a,a,0));var d=new THREE.LineBasicMaterial({fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(c,d);this.add(this.lightPlane);
c=new THREE.Geometry;c.vertices.push(new THREE.Vector3,new THREE.Vector3);d=new THREE.LineBasicMaterial({fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(c,d);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);
THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};
THREE.DirectionalLightHelper.prototype.update=function(){var b=new THREE.Vector3,a=new THREE.Vector3,c=new THREE.Vector3;return function(){b.setFromMatrixPosition(this.light.matrixWorld);a.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(a,b);this.lightPlane.lookAt(c);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(c);this.targetLine.geometry.verticesNeedUpdate=!0;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();THREE.EdgesHelper=function(b,a){var c=void 0!==a?a:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry,k=b.geometry.clone();k.mergeVertices();k.computeFaceNormals();for(var l=k.vertices,k=k.faces,n=0,p=0,r=k.length;p<r;p++)for(var q=k[p],s=0;3>s;s++){d[0]=q[g[s]];d[1]=q[g[(s+1)%3]];d.sort(f);var m=d.toString();void 0===e[m]?(e[m]={vert1:d[0],vert2:d[1],face1:p,face2:void 0},n++):e[m].face2=p}h.addAttribute("position",new THREE.Float32Attribute(2*n,3));d=h.attributes.position.array;
f=0;for(m in e)if(g=e[m],void 0===g.face2||0.9999>k[g.face1].normal.dot(k[g.face2].normal))n=l[g.vert1],d[f++]=n.x,d[f++]=n.y,d[f++]=n.z,n=l[g.vert2],d[f++]=n.x,d[f++]=n.y,d[f++]=n.z;THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.matrixWorld=b.matrixWorld};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper=function(b,a,c,d){this.object=b;this.size=void 0!==a?a:1;b=void 0!==c?c:16776960;d=void 0!==d?d:1;a=new THREE.Geometry;c=0;for(var e=this.object.geometry.faces.length;c<e;c++)a.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:b,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.FaceNormalsHelper.prototype.update=function(){var b=this.geometry.vertices,a=this.object,c=a.geometry.vertices,d=a.geometry.faces,e=a.matrixWorld;a.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(e);for(var f=a=0,g=d.length;a<g;a++,f+=2){var h=d[a];b[f].copy(c[h.a]).add(c[h.b]).add(c[h.c]).divideScalar(3).applyMatrix4(e);b[f+1].copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(b[f])}this.geometry.verticesNeedUpdate=!0;return this};THREE.GridHelper=function(b,a){var c=new THREE.Geometry,d=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var e=-b;e<=b;e+=a){c.vertices.push(new THREE.Vector3(-b,0,e),new THREE.Vector3(b,0,e),new THREE.Vector3(e,0,-b),new THREE.Vector3(e,0,b));var f=0===e?this.color1:this.color2;c.colors.push(f,f,f,f)}THREE.Line.call(this,c,d,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);
THREE.GridHelper.prototype.setColors=function(b,a){this.color1.set(b);this.color2.set(a);this.geometry.colorsNeedUpdate=!0};THREE.HemisphereLightHelper=function(b,a,c,d){THREE.Object3D.call(this);this.light=b;this.light.updateMatrixWorld();this.matrixWorld=b.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new THREE.Color,new THREE.Color];b=new THREE.SphereGeometry(a,4,2);b.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(a=0;8>a;a++)b.faces[a].color=this.colors[4>a?0:1];a=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(b,a);this.add(this.lightSphere);
this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};
THREE.HemisphereLightHelper.prototype.update=function(){var b=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(b.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();THREE.PointLightHelper=function(b,a){this.light=b;this.light.updateMatrixWorld();var c=new THREE.SphereGeometry(a,12,8),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,d);this.matrixWorld=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};
THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SpotLightHelper=function(b){THREE.Object3D.call(this);this.light=b;this.light.updateMatrixWorld();this.matrixWorld=b.matrixWorld;this.matrixAutoUpdate=!1;b=new THREE.CylinderGeometry(0,1,1,8,1,!0);b.applyMatrix((new THREE.Matrix4).makeTranslation(0,-0.5,0));b.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var a=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(b,a);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);
THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var b=new THREE.Vector3,a=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1E4,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);b.setFromMatrixPosition(this.light.matrixWorld);a.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(a.sub(b));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();THREE.VertexNormalsHelper=function(b,a,c,d){this.object=b;this.size=void 0!==a?a:1;a=void 0!==c?c:16711680;d=void 0!==d?d:1;c=new THREE.Geometry;b=b.geometry.faces;for(var e=0,f=b.length;e<f;e++)for(var g=0,h=b[e].vertexNormals.length;g<h;g++)c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};
THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.VertexNormalsHelper.prototype.update=function(b){var a=new THREE.Vector3;return function(b){b=["a","b","c","d"];this.object.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var d=this.geometry.vertices,e=this.object.geometry.vertices,f=this.object.geometry.faces,g=this.object.matrixWorld,h=0,k=0,l=f.length;k<l;k++)for(var n=f[k],p=0,r=n.vertexNormals.length;p<r;p++){var q=n.vertexNormals[p];d[h].copy(e[n[b[p]]]).applyMatrix4(g);a.copy(q).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);
a.add(d[h]);h+=1;d[h].copy(a);h+=1}this.geometry.verticesNeedUpdate=!0;return this}}();THREE.VertexTangentsHelper=function(b,a,c,d){this.object=b;this.size=void 0!==a?a:1;a=void 0!==c?c:255;d=void 0!==d?d:1;c=new THREE.Geometry;b=b.geometry.faces;for(var e=0,f=b.length;e<f;e++)for(var g=0,h=b[e].vertexTangents.length;g<h;g++)c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.VertexTangentsHelper.prototype.update=function(b){var a=new THREE.Vector3;return function(b){b=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var d=this.geometry.vertices,e=this.object.geometry.vertices,f=this.object.geometry.faces,g=this.object.matrixWorld,h=0,k=0,l=f.length;k<l;k++)for(var n=f[k],p=0,r=n.vertexTangents.length;p<r;p++){var q=n.vertexTangents[p];d[h].copy(e[n[b[p]]]).applyMatrix4(g);a.copy(q).transformDirection(g).multiplyScalar(this.size);a.add(d[h]);h+=1;d[h].copy(a);
h+=1}this.geometry.verticesNeedUpdate=!0;return this}}();THREE.WireframeHelper=function(b,a){var c=void 0!==a?a:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry;if(b.geometry instanceof THREE.Geometry){for(var k=b.geometry.vertices,l=b.geometry.faces,n=0,p=new Uint32Array(6*l.length),r=0,q=l.length;r<q;r++)for(var s=l[r],m=0;3>m;m++){d[0]=s[g[m]];d[1]=s[g[(m+1)%3]];d.sort(f);var u=d.toString();void 0===e[u]&&(p[2*n]=d[0],p[2*n+1]=d[1],e[u]=!0,n++)}h.addAttribute("position",new THREE.Float32Attribute(2*n,3));d=
h.attributes.position.array;r=0;for(q=n;r<q;r++)for(m=0;2>m;m++)n=k[p[2*r+m]],g=6*r+3*m,d[g+0]=n.x,d[g+1]=n.y,d[g+2]=n.z}else if(b.geometry instanceof THREE.BufferGeometry&&void 0!==b.geometry.attributes.index){for(var k=b.geometry.attributes.position.array,q=b.geometry.attributes.index.array,l=b.geometry.offsets,n=0,p=new Uint32Array(2*q.length),s=0,v=l.length;s<v;++s)for(var m=l[s].start,u=l[s].count,g=l[s].index,r=m,t=m+u;r<t;r+=3)for(m=0;3>m;m++)d[0]=g+q[r+m],d[1]=g+q[r+(m+1)%3],d.sort(f),u=d.toString(),
void 0===e[u]&&(p[2*n]=d[0],p[2*n+1]=d[1],e[u]=!0,n++);h.addAttribute("position",new THREE.Float32Attribute(2*n,3));d=h.attributes.position.array;r=0;for(q=n;r<q;r++)for(m=0;2>m;m++)g=6*r+3*m,n=3*p[2*r+m],d[g+0]=k[n],d[g+1]=k[n+1],d[g+2]=k[n+2]}else if(b.geometry instanceof THREE.BufferGeometry)for(k=b.geometry.attributes.position.array,n=k.length/3,p=n/3,h.addAttribute("position",new THREE.Float32Attribute(2*n,3)),d=h.attributes.position.array,r=0,q=p;r<q;r++)for(m=0;3>m;m++)g=18*r+6*m,p=9*r+3*m,
d[g+0]=k[p],d[g+1]=k[p+1],d[g+2]=k[p+2],n=9*r+(m+1)%3*3,d[g+3]=k[n],d[g+4]=k[n+1],d[g+5]=k[n+2];THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.matrixWorld=b.matrixWorld};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(b){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare=function(b,a,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==b&&this.add(b,a,c,d,e)};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);
THREE.LensFlare.prototype.add=function(b,a,c,d,e,f){void 0===a&&(a=-1);void 0===c&&(c=0);void 0===f&&(f=1);void 0===e&&(e=new THREE.Color(16777215));void 0===d&&(d=THREE.NormalBlending);c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:a,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:f,color:e,blending:d})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,a=this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(b=0;b<a;b++)c=this.lensFlares[b],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=c.x*Math.PI*0.25,c.rotation+=0.25*(c.wantedRotation-c.rotation)};THREE.MorphBlendMesh=function(b,a){THREE.Mesh.call(this,b,a);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation("__default",0,c-1,c/1);this.setAnimationWeight("__default",1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);
THREE.MorphBlendMesh.prototype.createAnimation=function(b,a,c,d){a={startFrame:a,endFrame:c,length:c-a+1,fps:d,duration:(c-a)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[b]=a;this.animationsList.push(a)};
THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(b){for(var a=/([a-z]+)(\d+)/,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f].name.match(a);if(h&&1<h.length){var k=h[1];d[k]||(d[k]={start:Infinity,end:-Infinity});h=d[k];f<h.start&&(h.start=f);f>h.end&&(h.end=f);c||(c=k)}}for(k in d)h=d[k],this.createAnimation(k,h.start,h.end,b);this.firstAnimation=c};
THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(b){if(b=this.animationsMap[b])b.direction=1,b.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(b){if(b=this.animationsMap[b])b.direction=-1,b.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(b,a){var c=this.animationsMap[b];c&&(c.fps=a,c.duration=(c.end-c.start)/c.fps)};
THREE.MorphBlendMesh.prototype.setAnimationDuration=function(b,a){var c=this.animationsMap[b];c&&(c.duration=a,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(b,a){var c=this.animationsMap[b];c&&(c.weight=a)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(b,a){var c=this.animationsMap[b];c&&(c.time=a)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(b){var a=0;if(b=this.animationsMap[b])a=b.time;return a};
THREE.MorphBlendMesh.prototype.getAnimationDuration=function(b){var a=-1;if(b=this.animationsMap[b])a=b.duration;return a};THREE.MorphBlendMesh.prototype.playAnimation=function(b){var a=this.animationsMap[b];a?(a.time=0,a.active=!0):console.warn("animation["+b+"] undefined")};THREE.MorphBlendMesh.prototype.stopAnimation=function(b){if(b=this.animationsMap[b])b.active=!1};
THREE.MorphBlendMesh.prototype.update=function(b){for(var a=0,c=this.animationsList.length;a<c;a++){var d=this.animationsList[a];if(d.active){var e=d.duration/d.length;d.time+=d.direction*b;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.startFrame+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;
f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);this.morphTargetInfluences[d.currentFrame]=e*g;this.morphTargetInfluences[d.lastFrame]=(1-e)*g}}};THREE.LensFlarePlugin=function(){function b(b,c){var d=a.createProgram(),e=a.createShader(a.FRAGMENT_SHADER),f=a.createShader(a.VERTEX_SHADER),g="precision "+c+" float;\nprecision "+c+" int;\n";a.shaderSource(e,g+b.fragmentShader);a.shaderSource(f,g+b.vertexShader);a.compileShader(e);a.compileShader(f);a.attachShader(d,e);a.attachShader(d,f);a.linkProgram(d);return d}var a,c,d,e,f,g,h,k,l,n,p,r,q;this.init=function(s){a=s.context;c=s;d=s.getPrecision();e=new Float32Array(16);f=new Uint16Array(6);
s=0;e[s++]=-1;e[s++]=-1;e[s++]=0;e[s++]=0;e[s++]=1;e[s++]=-1;e[s++]=1;e[s++]=0;e[s++]=1;e[s++]=1;e[s++]=1;e[s++]=1;e[s++]=-1;e[s++]=1;e[s++]=0;e[s++]=1;s=0;f[s++]=0;f[s++]=1;f[s++]=2;f[s++]=0;f[s++]=2;f[s++]=3;g=a.createBuffer();h=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,g);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,h);a.bufferData(a.ELEMENT_ARRAY_BUFFER,f,a.STATIC_DRAW);k=a.createTexture();l=a.createTexture();a.bindTexture(a.TEXTURE_2D,k);a.texImage2D(a.TEXTURE_2D,
0,a.RGB,16,16,0,a.RGB,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.bindTexture(a.TEXTURE_2D,l);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,16,16,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,
a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);0>=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(n=!1,p=b(THREE.ShaderFlares.lensFlare,d)):(n=!0,p=b(THREE.ShaderFlares.lensFlareVertexTexture,d));r={};q={};r.vertex=a.getAttribLocation(p,"position");r.uv=a.getAttribLocation(p,"uv");q.renderType=a.getUniformLocation(p,"renderType");q.map=a.getUniformLocation(p,"map");q.occlusionMap=a.getUniformLocation(p,"occlusionMap");
q.opacity=a.getUniformLocation(p,"opacity");q.color=a.getUniformLocation(p,"color");q.scale=a.getUniformLocation(p,"scale");q.rotation=a.getUniformLocation(p,"rotation");q.screenPosition=a.getUniformLocation(p,"screenPosition")};this.render=function(b,d,e,f){b=b.__webglFlares;var t=b.length;if(t){var E=new THREE.Vector3,y=f/e,x=0.5*e,w=0.5*f,B=16/f,A=new THREE.Vector2(B*y,B),z=new THREE.Vector3(1,1,0),G=new THREE.Vector2(1,1),F=q,B=r;a.useProgram(p);a.enableVertexAttribArray(r.vertex);a.enableVertexAttribArray(r.uv);
a.uniform1i(F.occlusionMap,0);a.uniform1i(F.map,1);a.bindBuffer(a.ARRAY_BUFFER,g);a.vertexAttribPointer(B.vertex,2,a.FLOAT,!1,16,0);a.vertexAttribPointer(B.uv,2,a.FLOAT,!1,16,8);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,h);a.disable(a.CULL_FACE);a.depthMask(!1);var K,H,N,L,D;for(K=0;K<t;K++)if(B=16/f,A.set(B*y,B),L=b[K],E.set(L.matrixWorld.elements[12],L.matrixWorld.elements[13],L.matrixWorld.elements[14]),E.applyMatrix4(d.matrixWorldInverse),E.applyProjection(d.projectionMatrix),z.copy(E),G.x=z.x*x+x,
G.y=z.y*w+w,n||0<G.x&&G.x<e&&0<G.y&&G.y<f)for(a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,k),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGB,G.x-8,G.y-8,16,16,0),a.uniform1i(F.renderType,0),a.uniform2f(F.scale,A.x,A.y),a.uniform3f(F.screenPosition,z.x,z.y,z.z),a.disable(a.BLEND),a.enable(a.DEPTH_TEST),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,l),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,G.x-8,G.y-8,16,16,0),a.uniform1i(F.renderType,1),a.disable(a.DEPTH_TEST),
a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,k),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0),L.positionScreen.copy(z),L.customUpdateCallback?L.customUpdateCallback(L):L.updateLensFlares(),a.uniform1i(F.renderType,2),a.enable(a.BLEND),H=0,N=L.lensFlares.length;H<N;H++)D=L.lensFlares[H],0.001<D.opacity&&0.001<D.scale&&(z.x=D.x,z.y=D.y,z.z=D.z,B=D.size*D.scale/f,A.x=B*y,A.y=B,a.uniform3f(F.screenPosition,z.x,z.y,z.z),a.uniform2f(F.scale,A.x,A.y),a.uniform1f(F.rotation,D.rotation),a.uniform1f(F.opacity,
D.opacity),a.uniform3f(F.color,D.color.r,D.color.g,D.color.b),c.setBlending(D.blending,D.blendEquation,D.blendSrc,D.blendDst),c.setTexture(D.texture,1),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0));a.enable(a.CULL_FACE);a.enable(a.DEPTH_TEST);a.depthMask(!0)}}};THREE.ShadowMapPlugin=function(){var b,a,c,d,e,f,g=new THREE.Frustum,h=new THREE.Matrix4,k=new THREE.Vector3,l=new THREE.Vector3,n=new THREE.Vector3;this.init=function(g){b=g.context;a=g;g=THREE.ShaderLib.depthRGBA;var h=THREE.UniformsUtils.clone(g.uniforms);c=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h});d=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0});e=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,
vertexShader:g.vertexShader,uniforms:h,skinning:!0});f=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0,skinning:!0});c._shadowPass=!0;d._shadowPass=!0;e._shadowPass=!0;f._shadowPass=!0};this.render=function(b,c){a.shadowMapEnabled&&a.shadowMapAutoUpdate&&this.update(b,c)};this.update=function(p,r){var q,s,m,u,v,t,E,y,x,w,B=[];u=0;b.clearColor(1,1,1,1);b.disable(b.BLEND);b.enable(b.CULL_FACE);b.frontFace(b.CCW);a.shadowMapCullFace===
THREE.CullFaceFront?b.cullFace(b.FRONT):b.cullFace(b.BACK);a.setDepthTest(!0);q=0;for(s=p.__lights.length;q<s;q++)if(m=p.__lights[q],m.castShadow)if(m instanceof THREE.DirectionalLight&&m.shadowCascade)for(v=0;v<m.shadowCascadeCount;v++){if(m.shadowCascadeArray[v])t=m.shadowCascadeArray[v];else{x=m;w=v;t=new THREE.DirectionalLight;t.isVirtual=!0;t.onlyShadow=!0;t.castShadow=!0;t.shadowCameraNear=x.shadowCameraNear;t.shadowCameraFar=x.shadowCameraFar;t.shadowCameraLeft=x.shadowCameraLeft;t.shadowCameraRight=
x.shadowCameraRight;t.shadowCameraBottom=x.shadowCameraBottom;t.shadowCameraTop=x.shadowCameraTop;t.shadowCameraVisible=x.shadowCameraVisible;t.shadowDarkness=x.shadowDarkness;t.shadowBias=x.shadowCascadeBias[w];t.shadowMapWidth=x.shadowCascadeWidth[w];t.shadowMapHeight=x.shadowCascadeHeight[w];t.pointsWorld=[];t.pointsFrustum=[];var A=t.pointsWorld;y=t.pointsFrustum;for(E=0;8>E;E++)A[E]=new THREE.Vector3,y[E]=new THREE.Vector3;A=x.shadowCascadeNearZ[w];x=x.shadowCascadeFarZ[w];y[0].set(-1,-1,A);
y[1].set(1,-1,A);y[2].set(-1,1,A);y[3].set(1,1,A);y[4].set(-1,-1,x);y[5].set(1,-1,x);y[6].set(-1,1,x);y[7].set(1,1,x);t.originalCamera=r;y=new THREE.Gyroscope;y.position.copy(m.shadowCascadeOffset);y.add(t);y.add(t.target);r.add(y);m.shadowCascadeArray[v]=t;console.log("Created virtualLight",t)}w=m;A=v;x=w.shadowCascadeArray[A];x.position.copy(w.position);x.target.position.copy(w.target.position);x.lookAt(x.target.position);x.shadowCameraVisible=w.shadowCameraVisible;x.shadowDarkness=w.shadowDarkness;
x.shadowBias=w.shadowCascadeBias[A];y=w.shadowCascadeNearZ[A];w=w.shadowCascadeFarZ[A];x=x.pointsFrustum;x[0].z=y;x[1].z=y;x[2].z=y;x[3].z=y;x[4].z=w;x[5].z=w;x[6].z=w;x[7].z=w;B[u]=t;u++}else B[u]=m,u++;q=0;for(s=B.length;q<s;q++){m=B[q];m.shadowMap||(v=THREE.LinearFilter,a.shadowMapType===THREE.PCFSoftShadowMap&&(v=THREE.NearestFilter),m.shadowMap=new THREE.WebGLRenderTarget(m.shadowMapWidth,m.shadowMapHeight,{minFilter:v,magFilter:v,format:THREE.RGBAFormat}),m.shadowMapSize=new THREE.Vector2(m.shadowMapWidth,
m.shadowMapHeight),m.shadowMatrix=new THREE.Matrix4);if(!m.shadowCamera){if(m instanceof THREE.SpotLight)m.shadowCamera=new THREE.PerspectiveCamera(m.shadowCameraFov,m.shadowMapWidth/m.shadowMapHeight,m.shadowCameraNear,m.shadowCameraFar);else if(m instanceof THREE.DirectionalLight)m.shadowCamera=new THREE.OrthographicCamera(m.shadowCameraLeft,m.shadowCameraRight,m.shadowCameraTop,m.shadowCameraBottom,m.shadowCameraNear,m.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue}p.add(m.shadowCamera);
!0===p.autoUpdate&&p.updateMatrixWorld()}m.shadowCameraVisible&&!m.cameraHelper&&(m.cameraHelper=new THREE.CameraHelper(m.shadowCamera),m.shadowCamera.add(m.cameraHelper));if(m.isVirtual&&m.originalCamera==r){v=r;u=m.shadowCamera;t=m.pointsFrustum;y=m.pointsWorld;k.set(Infinity,Infinity,Infinity);l.set(-Infinity,-Infinity,-Infinity);for(x=0;8>x;x++)w=y[x],w.copy(t[x]),THREE.ShadowMapPlugin.__projector.unprojectVector(w,v),w.applyMatrix4(u.matrixWorldInverse),w.x<k.x&&(k.x=w.x),w.x>l.x&&(l.x=w.x),
w.y<k.y&&(k.y=w.y),w.y>l.y&&(l.y=w.y),w.z<k.z&&(k.z=w.z),w.z>l.z&&(l.z=w.z);u.left=k.x;u.right=l.x;u.top=l.y;u.bottom=k.y;u.updateProjectionMatrix()}u=m.shadowMap;t=m.shadowMatrix;v=m.shadowCamera;v.position.setFromMatrixPosition(m.matrixWorld);n.setFromMatrixPosition(m.target.matrixWorld);v.lookAt(n);v.updateMatrixWorld();v.matrixWorldInverse.getInverse(v.matrixWorld);m.cameraHelper&&(m.cameraHelper.visible=m.shadowCameraVisible);m.shadowCameraVisible&&m.cameraHelper.update();t.set(0.5,0,0,0.5,0,
0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);t.multiply(v.projectionMatrix);t.multiply(v.matrixWorldInverse);h.multiplyMatrices(v.projectionMatrix,v.matrixWorldInverse);g.setFromMatrix(h);a.setRenderTarget(u);a.clear();w=p.__webglObjects;m=0;for(u=w.length;m<u;m++)y=w[m],x=y.object,y.render=!1,!x.visible||!x.castShadow||(x instanceof THREE.Mesh||x instanceof THREE.ParticleSystem)&&x.frustumCulled&&!g.intersectsObject(x)||(x._modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,x.matrixWorld),y.render=!0);var z;
m=0;for(u=w.length;m<u;m++)y=w[m],y.render&&(x=y.object,t=y.buffer,A=x.material instanceof THREE.MeshFaceMaterial?x.material.materials[0]:x.material,E=void 0!==x.geometry.morphTargets&&0<x.geometry.morphTargets.length&&A.morphTargets,z=x instanceof THREE.SkinnedMesh&&A.skinning,E=x.customDepthMaterial?x.customDepthMaterial:z?E?f:e:E?d:c,a.setMaterialFaces(A),t instanceof THREE.BufferGeometry?a.renderBufferDirect(v,p.__lights,null,E,t,x,y.offsetIndices):a.renderBuffer(v,p.__lights,null,E,t,x));w=p.__webglObjectsImmediate;
m=0;for(u=w.length;m<u;m++)y=w[m],x=y.object,x.visible&&x.castShadow&&(x._modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,x.matrixWorld),a.renderImmediateObject(v,p.__lights,null,c,x))}q=a.getClearColor();s=a.getClearAlpha();b.clearColor(q.r,q.g,q.b,s);b.enable(b.BLEND);a.shadowMapCullFace===THREE.CullFaceFront&&b.cullFace(b.BACK)}};THREE.ShadowMapPlugin.__projector=new THREE.Projector;THREE.SpritePlugin=function(){var b,a,c,d,e,f,g,h,k,l,n,p,r,q,s,m,u;function v(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}var t,E,y,x,w,B,A,z;this.init=function(v){t=v.context;E=v;x=new Float32Array([-0.5,-0.5,0,0,0.5,-0.5,1,0,0.5,0.5,1,1,-0.5,0.5,0,1]);w=new Uint16Array([0,1,2,0,2,3]);B=t.createBuffer();A=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,B);t.bufferData(t.ARRAY_BUFFER,x,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,A);t.bufferData(t.ELEMENT_ARRAY_BUFFER,w,t.STATIC_DRAW);v=t.createProgram();
var F=t.createShader(t.VERTEX_SHADER),K=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(F,["precision "+E.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
t.shaderSource(K,["precision "+E.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
t.compileShader(F);t.compileShader(K);t.attachShader(v,F);t.attachShader(v,K);t.linkProgram(v);z=v;m=t.getAttribLocation(z,"position");u=t.getAttribLocation(z,"uv");b=t.getUniformLocation(z,"uvOffset");a=t.getUniformLocation(z,"uvScale");c=t.getUniformLocation(z,"rotation");d=t.getUniformLocation(z,"scale");e=t.getUniformLocation(z,"color");f=t.getUniformLocation(z,"map");g=t.getUniformLocation(z,"opacity");h=t.getUniformLocation(z,"modelViewMatrix");k=t.getUniformLocation(z,"projectionMatrix");l=
t.getUniformLocation(z,"fogType");n=t.getUniformLocation(z,"fogDensity");p=t.getUniformLocation(z,"fogNear");r=t.getUniformLocation(z,"fogFar");q=t.getUniformLocation(z,"fogColor");s=t.getUniformLocation(z,"alphaTest");v=document.createElement("canvas");v.width=8;v.height=8;F=v.getContext("2d");F.fillStyle="#ffffff";F.fillRect(0,0,v.width,v.height);y=new THREE.Texture(v);y.needsUpdate=!0};this.render=function(x,w,K,H){K=x.__webglSprites;if(H=K.length){t.useProgram(z);t.enableVertexAttribArray(m);
t.enableVertexAttribArray(u);t.disable(t.CULL_FACE);t.enable(t.BLEND);t.bindBuffer(t.ARRAY_BUFFER,B);t.vertexAttribPointer(m,2,t.FLOAT,!1,16,0);t.vertexAttribPointer(u,2,t.FLOAT,!1,16,8);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,A);t.uniformMatrix4fv(k,!1,w.projectionMatrix.elements);t.activeTexture(t.TEXTURE0);t.uniform1i(f,0);var N=0,L=0,D=x.fog;D?(t.uniform3f(q,D.color.r,D.color.g,D.color.b),D instanceof THREE.Fog?(t.uniform1f(p,D.near),t.uniform1f(r,D.far),t.uniform1i(l,1),L=N=1):D instanceof THREE.FogExp2&&
(t.uniform1f(n,D.density),t.uniform1i(l,2),L=N=2)):(t.uniform1i(l,0),L=N=0);for(var I,J=[],D=0;D<H;D++)I=K[D],!1!==I.visible&&(I._modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,I.matrixWorld),I.z=-I._modelViewMatrix.elements[14]);K.sort(v);for(D=0;D<H;D++)I=K[D],!1!==I.visible&&(w=I.material,t.uniform1f(s,w.alphaTest),t.uniformMatrix4fv(h,!1,I._modelViewMatrix.elements),J[0]=I.scale.x,J[1]=I.scale.y,I=x.fog&&w.fog?L:0,N!==I&&(t.uniform1i(l,I),N=I),null!==w.map?(t.uniform2f(b,w.map.offset.x,
w.map.offset.y),t.uniform2f(a,w.map.repeat.x,w.map.repeat.y)):(t.uniform2f(b,0,0),t.uniform2f(a,1,1)),t.uniform1f(g,w.opacity),t.uniform3f(e,w.color.r,w.color.g,w.color.b),t.uniform1f(c,w.rotation),t.uniform2fv(d,J),E.setBlending(w.blending,w.blendEquation,w.blendSrc,w.blendDst),E.setDepthTest(w.depthTest),E.setDepthWrite(w.depthWrite),w.map&&w.map.image&&w.map.image.width?E.setTexture(w.map,0):E.setTexture(y,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE)}}};THREE.DepthPassPlugin=function(){this.enabled=!1;this.renderTarget=null;var b,a,c,d,e,f,g=new THREE.Frustum,h=new THREE.Matrix4;this.init=function(g){b=g.context;a=g;g=THREE.ShaderLib.depthRGBA;var h=THREE.UniformsUtils.clone(g.uniforms);c=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h});d=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0});e=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,
vertexShader:g.vertexShader,uniforms:h,skinning:!0});f=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0,skinning:!0});c._shadowPass=!0;d._shadowPass=!0;e._shadowPass=!0;f._shadowPass=!0};this.render=function(a,b){this.enabled&&this.update(a,b)};this.update=function(k,l){var n,p,r,q,s,m,u;b.clearColor(1,1,1,1);b.disable(b.BLEND);a.setDepthTest(!0);!0===k.autoUpdate&&k.updateMatrixWorld();l.matrixWorldInverse.getInverse(l.matrixWorld);
h.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse);g.setFromMatrix(h);a.setRenderTarget(this.renderTarget);a.clear();u=k.__webglObjects;n=0;for(p=u.length;n<p;n++)s=u[n],m=s.object,s.render=!1,!m.visible||(m instanceof THREE.Mesh||m instanceof THREE.ParticleSystem)&&m.frustumCulled&&!g.intersectsObject(m)||(m._modelViewMatrix.multiplyMatrices(l.matrixWorldInverse,m.matrixWorld),s.render=!0);var v;n=0;for(p=u.length;n<p;n++)s=u[n],s.render&&(m=s.object,r=s.buffer,m instanceof THREE.ParticleSystem&&
!m.customDepthMaterial||((v=m.material instanceof THREE.MeshFaceMaterial?m.material.materials[0]:m.material)&&a.setMaterialFaces(m.material),q=void 0!==m.geometry.morphTargets&&0<m.geometry.morphTargets.length&&v.morphTargets,v=m instanceof THREE.SkinnedMesh&&v.skinning,q=m.customDepthMaterial?m.customDepthMaterial:v?q?f:e:q?d:c,r instanceof THREE.BufferGeometry?a.renderBufferDirect(l,k.__lights,null,q,r,m,s.offsetIndices):a.renderBuffer(l,k.__lights,null,q,r,m)));u=k.__webglObjectsImmediate;n=0;
for(p=u.length;n<p;n++)s=u[n],m=s.object,m.visible&&(m._modelViewMatrix.multiplyMatrices(l.matrixWorldInverse,m.matrixWorld),a.renderImmediateObject(l,k.__lights,null,c,m));n=a.getClearColor();p=a.getClearAlpha();b.clearColor(n.r,n.g,n.b,p);b.enable(b.BLEND)}};THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}};
