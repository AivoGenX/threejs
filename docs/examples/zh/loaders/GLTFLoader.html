<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<base href="../../../" />
		<script src="list.js"></script>
		<script src="page.js"></script>
		<link type="text/css" rel="stylesheet" href="page.css" />
	</head>
	<body>
		[page:Loader] &rarr;
		<h1>GLTF加载器（[name]）</h1>

		<p class="desc">一个用于加载<em>glTF 2.0</em>资源的加载器。<br /><br />
		gl传输格式（[link:https://www.khronos.org/gltf glTF] ，GL Transmission Format） 是一种
		[link:https://github.com/KhronosGroup/glTF/tree/master/specification/2.0 open format specification]（开放的格式规范），
		用于高效地传输和加载3D内容。GLTF组件以JSON（.gltf）格式或二进制（.glb）格式来提供。外部文件存储纹理（.jpg, .png）和额外的二进制数据（.bin），
		一个GLTF组件可以传输一个或多个场景，包括网格、材质、纹理贴图、蒙皮、骨架、变形目标、动画、灯光和/或摄像机。
		</p>

		<h2>扩展</h2>

		<p>
			GLTFLoader支持下列glTF 2.0扩展
			（[link:https://github.com/KhronosGroup/glTF/tree/master/extensions/ glTF 2.0 extensions]）：
		</p>

		<ul>
			<li>KHR_draco_mesh_compression</li>
			<li>KHR_materials_pbrSpecularGlossiness</li>
			<li>KHR_materials_unlit</li>
			<li>KHR_lights_punctual (experimental)</li>
			<li>KHR_texture_transform<sup>*</sup></li>
			<li>MSFT_texture_dds</li>
		</ul>

		<p><i>
			<sup>*</sup>UV变换是可以被支持的，但有几个关键的限制。
			
			应用于使用第一个UV插槽的纹理（除了aoMap和lightMap之外）的变换，必须共用相同的变换，或完全不变换。
			aoMap和lightMap不能被变换。每次使用具有唯一变换的纹理，将会导致一次额外的GPU纹理上传。
			请参阅#[link:https://github.com/mrdoob/three.js/pull/13831 13831]和
			#[link:https://github.com/mrdoob/three.js/issues/12788 12788]。
		</i></p>

		<h2>示例</h2>

		<code>
		// Instantiate a loader
		var loader = new THREE.GLTFLoader();

		// Optional: Provide a DRACOLoader instance to decode compressed mesh data
		THREE.DRACOLoader.setDecoderPath( '/examples/js/libs/draco' );
		loader.setDRACOLoader( new THREE.DRACOLoader() );

		// Load a glTF resource
		loader.load(
			// resource URL
			'models/gltf/duck/duck.gltf',
			// called when the resource is loaded
			function ( gltf ) {

				scene.add( gltf.scene );

				gltf.animations; // Array&lt;THREE.AnimationClip&gt;
				gltf.scene; // THREE.Scene
				gltf.scenes; // Array&lt;THREE.Scene&gt;
				gltf.cameras; // Array&lt;THREE.Camera&gt;
				gltf.asset; // Object

			},
			// called while loading is progressing
			function ( xhr ) {

				console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );

			},
			// called when loading has errors
			function ( error ) {

				console.log( 'An error happened' );

			}
		);
		</code>

		[example:webgl_loader_gltf]

		<h2>浏览器兼容性</h2>

		<p>GLTFLoader依赖于ES6中的[link:https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise Promise]，
		但IE11不支持Promise。
		若要在IE11中使用这一加载器，你将需要引入一个差异化支持（[link:https://github.com/stefanpenner/es6-promise include a polyfill]），
		提供一个Promise的替代方案。</p>

		<h2>纹理</h2>

		<p>包含颜色信息（.map、.emissiveMap和.specularMap）的纹理在glTF中始终使用sRGB颜色空间，
		而顶点颜色和材质属性（.color、.emissive、.specular）使用的是线性颜色空间。
		在典型的渲染工作流程中，纹理会被渲染器转换为线性颜色空间，并进行光照计算，然后将最终的输出转换回sRGB并显示在屏幕上。
		除非你需要在线性颜色空间中进行后期处理，否则在使用glTF时应始终按照下列方式来配置[page:WebGLRenderer]：</p>

		<code>
		renderer.gammaOutput = true;
		renderer.gammaFactor = 2.2;
		</code>

		<p>假设渲染器的配置如上所示，则GLTFLoader将会自动地正确配置引用自.gltf或.glb文件中的纹理。
		当从外部载入纹理（例如使用[page:TextureLoader]）并将它们应用到glTF模型上，必须要给出颜色空间与方向：</p>

		<code>
		// If texture is used for color information, set colorspace.
		texture.encoding = THREE.sRGBEncoding;

		// UVs use the convention that (0, 0) corresponds to the upper left corner of a texture.
		texture.flipY = false;
		</code>

		<h2>自定义扩展</h2>

		<p>
			来自未知扩展的元数据在Object3D、Scene和Material实例上保留为“.userData.gltfExtensions”，
			或附加到对应的“gltf”对象。例如：
		</p>

		<code>
		loader.load('foo.gltf', function ( gltf ) {

			var scene = gltf.scene;

			var mesh = scene.children[ 3 ];

			var fooExtension = mesh.userData.gltfExtensions.EXT_foo;

			gltf.parser.getDependency( 'bufferView', fooExtension.bufferView )
				.then( function ( fooBuffer ) { ... } );

		} );
		</code>

		<br>
		<hr>

		<h2>构造函数</h2>

		<h3>[name]( [param:LoadingManager manager] )</h3>
		<p>
		[page:LoadingManager manager] — 加载器使用的[page:LoadingManager loadingManager]（加载管理器），默认值是[page:LoadingManager THREE.DefaultLoadingManager]。
		</p>
		<p>
		创建一个新的[name]。
		</p>

		<h2>属性</h2>


		<h2>方法</h2>

		<h3>[method:null load]( [param:String url], [param:Function onLoad], [param:Function onProgress], [param:Function onError] )</h3>
		<p>
		[page:String url] — 一个包含有<em>.gltf</em>或<em>.glb</em>文件的路径或URL的字符串。<br />
		[page:Function onLoad] — 当加载过程成功完成以后将被调用的函数。这一函数接收一个被载入的[page:Object3D]来作为参数。<br />
		[page:Function onProgress] — （可选）加载过程正在进行的时候被调用的函数。其参数是一个XMLHttpRequest实例，其包含了[page:Integer total] bytes（总的字节数）和[page:Integer loaded] bytes（已经载入的字节数）。<br />
		[page:Function onError] — （可选） 加载过程中若发生了错误将被调用的函数。这一函数接收错误作为参数。<br />
		</p>
		<p>
		开始从URL中进行加载，并使用解析的响应内容调用回调函数。
		</p>

		<h3>[method:GLTFLoader setPath]( [param:String path] )</h3>
		<p>
		[page:String path] — 基础路径。
		</p>
		<p>
		设置.gltf/.glb文件的基础路径。
		</p>

		<h3>[method:GLTFLoader setResourcePath]( [param:String path] )</h3>
		<p>
		[page:String path] — 加载额外资源（例如纹理和.bin数据）的基础路径。
		</p>
		<p>
		设置外部资源的基础路径。
		</p>

		<h3>[method:null setCrossOrigin]( [param:String value] )</h3>
		<p>
		[page:String value] — 实现CORS（跨域资源共享）的crossOrigin字符串，用于从允许CORS的其它域加载URL。
		</p>

		<h3>[method:null setDRACOLoader]( [param:DRACOLoader dracoLoader] )</h3>
		<p>
		[page:DRACOLoader dracoLoader] — THREE.DRACOLoader的实例，用于解码使用KHR_draco_mesh_compression扩展压缩的组件。
		</p>
		<p>
		请参阅[link:https://github.com/mrdoob/three.js/tree/dev/examples/js/libs/draco#readme readme]页面来了解Draco及其decoder（解码器）的详细信息。
		</p>

		<h3>[method:null parse]( [param:ArrayBuffer data], [param:String path], [param:Function onLoad], [param:Function onError] )</h3>
		<p>
		[page:ArrayBuffer data] — 将要被作为ArrayBuffer或<em>JSON</em>字符串来解析的glTF组件。<br />
		[page:String path] — 用于查找后续的glTF资源（例如纹理和.bin数据文件）的基本路径<br />
		[page:Function onLoad] — 当解析结束后将被调用的函数。<br />
		[page:Function onError] — （可选）当解析过程发生错误将被调用的函数。这一函数接收一个error来作为参数。<br />
		</p>
		<p>
		解析一个基于glTF的ArrayBuffer或<em>JSON</em>字符串，并在完成后触发[page:Function onLoad]回调。[page:Function onLoad]中的参数将会是一个包含这些部分的[page:object]（对象）：.[page:Scene scene]、.[page:Array scenes]、.[page:Array cameras]、.[page:Array animations]和.[page:Object asset]。
		</p>

		<h2>源代码</h2>

		[link:https://github.com/mrdoob/three.js/blob/master/examples/js/loaders/GLTFLoader.js examples/js/loaders/GLTFLoader.js]
	</body>
</html>
